# Javascript

## èµ·æº

ç½‘é¡µæµè§ˆå™¨è¯ç”Ÿåï¼Œè¿«åˆ‡éœ€è¦ä¸€ç§è¯­è¨€æ¥æ•´åˆç½‘é¡µå†…å®¹ä»¥åŠæ“ä½œå…¶å®ƒçš„äº‹æƒ…ã€‚äºæ˜¯ç½‘æ™¯å…¬å¸ Netscape è®©å¸ƒå…°ç™» Brendan Eich è®¾è®¡äº†è¿™ä¸ªè¯­è¨€ï¼ˆ1995.5ï¼‰ï¼Œæœ€åˆå–å Mochaï¼Œç„¶åæ˜¯ LiveScriptï¼ˆ1995.9ï¼‰ï¼Œæœ€åå¾—åˆ° Sun å…¬å¸çš„å•†æ ‡è®¸å¯ï¼Œæ”¹å JavaScriptï¼ˆ1995.12ï¼‰ã€‚

> å–åæ˜¯ä¸ºäº†è¹­ Java çƒ­åº¦ã€‚

ä¸ä¹…åï¼Œå¾®è½¯ä¹Ÿåœ¨ ie3 ä¸Šæ¨å‡ºäº†ç±»ä¼¼çš„ JScriptï¼Œç”±äºä¸¤å…¬å¸ç«äº‰æ¿€çƒˆï¼Œæ²¡æœ‰ä»»ä½•æ ‡å‡†å¯è¨€ã€‚äºæ˜¯ Netscape å‘ ECMA Internationalï¼ˆä¸€å®¶å›½é™…æ€§ä¼šå‘˜åˆ¶åº¦çš„ä¿¡æ¯å’Œç”µä¿¡æ ‡å‡†åˆ¶å®šç»„ç»‡ï¼‰æäº¤äº†è¯­è¨€æ ‡å‡†ï¼ˆ1996.11ï¼‰ã€‚

éšåï¼ŒECMA æ ¹æ®æäº¤çš„æ ‡å‡†åˆ¶å®šäº†è¯¥è„šæœ¬è¯­è¨€çš„æ ‡å‡†ï¼Œå¹¶å–å ECMAScriptï¼Œæ ‡å‡†ä¹Ÿå°±æ˜¯è§„èŒƒçš„æ–‡æ¡£åå­—å« ECMA-262ã€‚äºæ˜¯ JavaScript å°±æˆä¸ºäº† ECMAScript çš„å®ç°ä¹‹ä¸€ï¼ŒåŒæœŸè¿˜å‡ºç°äº† ActionScriptã€‚

> å› ä¸ºç‰ˆæƒåŸå› è¿™é‡Œä¸èƒ½å–å JavaScriptã€‚

ECMAScript çš„æ ‡å‡†æ¯å¹´å‘å¸ƒä¸€æ¬¡ã€‚ç°åœ¨ç”± TC39 ç»„ç»‡æ¥ç»§ç»­è´Ÿè´£ ECMAScript çš„æ ‡å‡†åˆ¶å®šã€‚

### Engine

æŒ‡ JavaScript å¼•æ“ï¼Œæ¯”å¦‚ V8ã€SpiderMonkey ç­‰ã€‚è´Ÿè´£è§£é‡Šä»£ç å¹¶æ‰§è¡Œã€‚

å¤§æ¦‚è¿‡ç¨‹ï¼š

1. byte stream decoder è§£ç ä»£ç ä¸ºä¸€ä¸ªä¸ªçš„ tokenï¼Œä¼ ç»™ Parserï¼Œç„¶åæ„é€ å‡º ASTï¼›
2. Interpreter éå† ASTï¼Œç”Ÿæˆå­—èŠ‚ç ï¼›
3. Profiler ç›‘è§†ä»£ç å¹¶å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼›
4. Compiler å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨å¯ä»¥è¯»å–çš„ä½çº§è¯­è¨€ï¼›

js ä»£ç  -> (Parser) -> AST -> (Interpreter) -> ByteCode -> (Compiler) -> MachineCode

### Runtime

æŒ‡ Engine çš„å…·ä½“è¿è¡Œç¯å¢ƒï¼Œæ¯”å¦‚æµè§ˆå™¨ã€NodeJS ç­‰ã€‚

å®ƒä»¬æä¾›äº†ä¸€äº›é¢å¤–çš„æ¥å£æ¨¡å—ï¼Œä¸”æŒ‰**äº‹ä»¶é©±åŠ¨**çš„æ–¹å¼è°ƒåº¦ä»»åŠ¡ï¼ˆEventLoopï¼‰ã€‚

### å•çº¿ç¨‹

å› ä¸º js é¢å¯¹çš„åº”ç”¨å¤§éƒ¨åˆ†æ˜¯ I/O å¯†é›†å‹åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™æ“ä½œç¡¬ç›˜ã€ç½‘ç»œè¯·æ±‚æ“ä½œç½‘å¡ï¼Œæ‰€ä»¥ä½¿ç”¨å•çº¿ç¨‹è¾ƒä¸ºæ–¹ä¾¿ï¼ˆcpu å¤§éƒ¨åˆ†å¾ˆé—²ï¼Œäº‹æƒ…äº¤ç»™ä¸åŒçš„çº¿ç¨‹åœ¨å¤„ç†ï¼‰ã€‚

å¦‚æœæ˜¯ CPU å¯†é›†å‹åº”ç”¨ï¼Œé‚£ä¹ˆä½¿ç”¨åŠŸèƒ½å¤šçº¿ç¨‹å°±è¾ƒä¸ºæ›´å¥½ï¼›

## è¡¨è¾¾å¼
è¡¨è¾¾å¼åªç”¨äºè®¡ç®—å€¼
## è¯­å¥

## è¯æ³•ç»“æ„
### æ ‡è¯†ç¬¦
ç”¨äºå¸¸é‡ã€å˜é‡ã€å±æ€§ã€å‡½æ•°å’Œç±»ï¼Œä»¥åŠä¸ºæŸäº›å¾ªç¯æä¾›æ ‡è®°ï¼ˆlabelï¼‰ã€‚

å¿…é¡»ä»¥å­—æ¯ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æˆ–ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰å¼€å¤´ã€‚
> æ•°å­—ä¸èƒ½ä½œä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä»¥ä¾¿JavaScriptåŒºåˆ†æ ‡è¯†ç¬¦å’Œæ•°å€¼ã€‚

è™½å»ºè®®æ ‡è¯†ç¬¦åªä½¿ç”¨ASCLLå­—æ¯å’Œæ•°å­—ï¼Œä½†æ˜¯æœ¬èº«æ”¯æŒUnicodeå­—æ¯ã€æ•°å­—ã€è±¡å½¢æ–‡å­—ã€‚

### è½¬ä¹‰åºåˆ—
ä¸ºäº†ä»…ä½¿ç”¨ASCIIå­—ç¬¦æ¥è¡¨ç¤ºUnicodeå­—ç¬¦ã€‚

ä»¥`\u`å¼€å¤´ï¼Œåè·Ÿ4ä½16è¿›åˆ¶æ•°å­—ï¼Œes6ä¸­å¯ä½¿ç”¨`\u{1-6ä½16è¿›åˆ¶æ•°å­—}`æ¥æ›´å¥½çš„è¡¨ç¤ºunicodeå­—ç¬¦ã€‚
> Unicodeå…è®¸ç”¨å¤šç§ç¼–ç æ–¹å¼è¡¨ç¤ºåŒä¸€ä¸ªå­—ç¬¦ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªå­—ç¬¦çœ‹èµ·æ¥ä¸€æ ·ï¼Œå´å¹¶ä¸ä¸¥æ ¼ç›¸ç­‰ï¼Œå› ä¸ºunicodeç¼–ç ä¸ä¸€æ ·ï¼Œè¿™æ˜¯éœ€è¦è¿›è¡ŒUnicodeçš„å½’ä¸€åŒ–ï¼Œå¸¸ç”¨çš„å½¢å¼æ˜¯NFCã€‚

### åˆ†å·ç­–ç•¥
JavaScriptå¹¶éä»»ä½•æ—¶å€™éƒ½æŠŠæ¢è¡Œç¬¦å½“ä½œåˆ†å·ï¼Œè€Œåªæ˜¯
åœ¨ä¸éšå¼æ·»åŠ åˆ†å·å°±æ— æ³•è§£æä»£ç çš„æƒ…å†µä¸‹æ‰è¿™ä¹ˆåšã€‚æ›´å‡†ç¡®åœ°è®²
ï¼ˆé™¤äº†ç¨åä»‹ç»çš„ä¸‰ç§ä¾‹å¤–æƒ…å†µï¼‰ï¼ŒJavaScriptåªåœ¨ä¸‹ä¸€ä¸ªéç©ºæ ¼
å­—ç¬¦æ— æ³•è¢«è§£é‡Šä¸ºå½“å‰è¯­å¥çš„ä¸€éƒ¨åˆ†æ—¶æ‰æŠŠæ¢è¡Œç¬¦å½“ä½œåˆ†å·ã€‚

> é€šå¸¸ï¼Œå¦‚æœè¯­å¥ä»¥(ã€[ã€/ã€+æˆ–-å¼€å¤´ï¼Œå°±æœ‰å¯èƒ½è¢«è§£é‡Šä¸ºä¹‹å‰è¯­å¥çš„ä¸€éƒ¨åˆ†ã€‚

JavaScriptåœ¨ä¸èƒ½æŠŠç¬¬äºŒè¡Œè§£æä¸ºç¬¬ä¸€è¡Œçš„è¿ç»­éƒ¨åˆ†æ—¶ï¼Œå¯¹æ¢
è¡Œç¬¦çš„è§£é‡Šæœ‰ä¸‰ç§ä¾‹å¤–æƒ…å†µã€‚
1. æ¶‰åŠreturnã€throwã€yieldã€breakå’Œcontinueè¯­å¥ï¼Œè¿™äº›è¯­å¥ç»å¸¸ç‹¬ç«‹å­˜åœ¨ï¼Œä½†æœ‰æ—¶å€™åé¢ä¹Ÿä¼šè·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦æˆ–è¡¨è¾¾å¼ã€‚å¦‚æœè¿™å‡ ä¸ªå•è¯åé¢ï¼ˆä»»ä½•å…¶ä»–æ ‡è®°å‰é¢ï¼‰æœ‰æ¢è¡Œç¬¦ï¼ŒJavaScriptå°±ä¼šæŠŠè¿™ä¸ªæ¢è¡Œç¬¦è§£é‡Šä¸ºåˆ†å·ã€‚
> ä¸€å®šä¸èƒ½åœ¨returnã€breakæˆ–continueç­‰å…³é”®å­—å’Œå®ƒä»¬åé¢çš„è¡¨è¾¾å¼ä¹‹é—´åŠ å…¥æ¢è¡Œç¬¦ã€‚
2. ++å’Œ--æ“ä½œç¬¦ã€‚
3. ç®­å¤´=>å¿…é¡»è·Ÿå‚æ•°åˆ—è¡¨åœ¨åŒä¸€è¡Œã€‚
## æ•°æ®ç±»å‹

5 ç§ åŸºæœ¬ç±»å‹ï¼Œåç»­åŠ å…¥äº† Symbolã€BigInt

### Undefined

`Undefined`æ˜¯ä¸€ç§ç±»å‹ï¼Œ`undefined`æ—¢æ˜¯å…¨å±€çš„ä¸€ä¸ªå˜é‡ï¼ˆä»¥å‰å¯æ›´æ”¹ï¼Œç°åœ¨å˜æˆäº† no-configurableã€no-writableã€no-enumerableï¼Œä¸è¿‡å±€éƒ¨ä½œç”¨åŸŸå¦‚ IEFE å¯é‡å†™ï¼‰,ä¹Ÿæ˜¯å…¨å±€å˜é‡`undefined`çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å…¨å±€å˜é‡`window.undefined`çš„å€¼ä¸º`undefined`ã€‚

ä»»ä½•å˜é‡æœªèµ‹å€¼ä¹‹å‰éƒ½æ˜¯ Undefined ç±»å‹ï¼Œä¸”å€¼ä¸º undefinedã€‚è€Œæˆ‘ä»¬å¸¸ç”¨ undefined è¿™ä¸ªå…¨å±€å˜é‡æ¥è¡¨ç¤ºå®ƒï¼Œæˆ–è€…ç”¨ void è¿ç®—æ¥äº§ç”Ÿä¸€ä¸ª undefined**å€¼**ã€‚

> void æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå¯¹ç»™å®šçš„è¡¨è¾¾å¼æ±‚å€¼ï¼Œç„¶åè¿”å› undefined(è¿™é‡ŒæŒ‡çš„æ˜¯å€¼ï¼Œè€Œä¸æ˜¯é‚£ä¸ªå«åš undefined çš„å…¨å±€å˜é‡)ã€‚

### Null

è¡¨ç¤ºè¿™ä¸ªå˜é‡æœªæŒ‡å‘ä»»ä½•å †å¯¹è±¡ï¼Œå¸¸ç”¨äºä¸»åŠ¨ GC å›æ”¶ã€‚

### Boolean

`''`/`undefined`/`null`/`0`/`+0`/`-0`/`NaN`/`false`ä½¿ç”¨ Boolean è½¬æ¢åï¼Œå‡ä¸º falseã€‚

### String

string åŸå§‹ç±»å‹æ•°æ®ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚

> `typeof null === 'object'`çš„æ¢—ã€‚åœ¨ JS çš„æœ€åˆç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ 32 ä½ç³»ç»Ÿï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ä½¿ç”¨ä½ä½å­˜å‚¨å˜é‡çš„ç±»å‹ä¿¡æ¯ï¼Œ000 å¼€å¤´ä»£è¡¨æ˜¯å¯¹è±¡ï¼Œç„¶è€Œ null è¡¨ç¤ºä¸ºå…¨é›¶ï¼Œæ‰€ä»¥å°†å®ƒé”™è¯¯çš„åˆ¤æ–­ä¸º object ã€‚è™½ç„¶ç°åœ¨çš„å†…éƒ¨ç±»å‹åˆ¤æ–­ä»£ç å·²ç»æ”¹å˜äº†ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ª Bug å´æ˜¯ä¸€ç›´æµä¼ ä¸‹æ¥ã€‚

String ç±»å‹æ˜¯é›¶ä¸ªæˆ–å¤šä¸ª 16 ä½æ— ç¬¦å·æ•´æ•°å€¼ï¼ˆ`UTF-16`ç¼–ç æ–¹å¼ï¼‰çš„æ‰€æœ‰æœ‰åºåºåˆ—çš„é›†åˆï¼Œæœ€å¤§é•¿åº¦ä¸º 2^53-1 ä¸ªæ•´æ•°å€¼ã€‚

Unicode ç ç‚¹èŒƒå›´ä¸º U+0000~U+FFFFï¼Œå…± 65536 ä¸ªï¼Œä¹Ÿå«åŸºæœ¬å­—ç¬¦åŒºåŸŸï¼ˆBMPï¼‰ã€‚

#### unicode ä¸å®é™…å€¼äº’è½¬

- String.prototype.charCodeAt()/String.prototype.codePointAt()
- String.fromCharCode()/String.fromCodePoint()
  > ç°åœ¨çš„å¾ˆå¤šæ–°å­—ç¬¦éƒ½è¶…å‡ºäº† 65536 ç ç‚¹èŒƒå›´ï¼Œå› æ­¤éœ€è¦ç”¨åè€… api æ¥æ“ä½œã€‚

#### è¶…å‡º BMP çš„å­—ç¬¦

å­—ç¬¦å¢å¤šåï¼Œæ ‡å‡†å†³å®šä»¥ 16 ä¸ºå­—ç¬¦ä¸ºä¸€ç»„ï¼Œä¸€ç»„ 65536 ä¸ªï¼Œä¸€ç»„ä¸ºä¸€ä¸ªå¹³é¢ï¼Œä¸€å…± 17 ä¸ªå¹³é¢ï¼Œå³ 0x00 åˆ° 0x10ã€‚

ä¾‹å¦‚ä¸€ä¸ª emoji è¡¨æƒ… ğŸ’Šï¼Œç ä½ä¸º`128138`ï¼Œè½¬æ¢ä¸º 16 è¿›åˆ¶ä¸º`1f48a`ï¼Œåœ¨ js ä¸­çš„è½¬ä¹‰åˆ™ä¸º`\u{1f48a}`ã€‚

#### æ˜¾ç¤ºæ–¹å¼

- htmlï¼Œä½¿ç”¨`&#x` + unicode ç ã€‚
- jsï¼Œä½¿ç”¨`\u` + unicode ç ï¼Œè¶…å‡º BMP åŒºåŸŸçš„éœ€è¦ä½¿ç”¨`{}`åŒ…è£¹ã€‚
- cssï¼Œä½¿ç”¨`\` + unicode ç ã€‚
- css å±æ€§`unicode-range`ï¼Œä½¿ç”¨`U+` + unicode ç ã€‚

### Number

Javascript ä¸­ä½¿ç”¨åŸºäº IEEE754 æ ‡å‡†çš„åŒç²¾åº¦æµ®ç‚¹æ•°æ¥è¡¨ç¤ºæ•°å­—ï¼Œæ ‡å‡†è§„å®šä¸€ä¸ªæ•°è¡¨ç¤ºä¸º`+-1.M * 2^e`ï¼Œç»“æ„å¦‚ä¸‹ï¼š

- `1` ç¬¦å·ä½ sign bitï¼Œç”¨æ¥è¡¨ç¤ºæ­£è´Ÿå·
- `11` æŒ‡æ•°ä½ exponentï¼Œç”¨æ¥è¡¨ç¤ºæ¬¡æ–¹æ•°
- `52` å°¾æ•° mantissaï¼Œç”¨æ¥è¡¨ç¤ºç²¾ç¡®åº¦

![](~images/js/General_double_precision_float.png)

> 0.1 + 0.2 è¿ç®—ä¸æ ‡å‡†çš„åŸå› å°±åœ¨äºæœ‰çš„æ•°ï¼ˆæ¯”å¦‚ 0.1ï¼‰ç”¨è¯¥æ–¹æ³•è¡¨è¾¾æ—¶æ˜¯æ— ç©·çš„ï¼Œå¿…é¡»è¿›è¡Œæˆªæ–­ï¼Œæ‰€ä»¥ä¸ç²¾ç¡®ã€‚è€Œæ­¤è¿ç®—ï¼Œæœ‰ 2 æ¬¡çš„èˆå…¥ï¼Œé€ æˆäº†ç²¾åº¦ä¸¢å¤±å¾ˆå¤§ã€‚æ¯”è¾ƒå¤§å°æ­£ç¡®çš„æ–¹å¼æ˜¯æ£€æŸ¥ç­‰å¼å·¦å³ä¸¤è¾¹å·®çš„ç»å¯¹å€¼æ˜¯å¦å°äºæœ€å°ç²¾åº¦ï¼š
> `Math.abs(0.1 + 0.2 - 0.3) <= Number.EPSILON`

> æµ®ç‚¹æ•°æ„ä¸ºå°æ•°ç‚¹ä½ç½®ä¸å›ºå®šçš„å°æ•°è¡¨ç¤ºæ–¹æ³•ï¼ŒåŒç²¾åº¦ï¼ˆåŒå€ç²¾åº¦ 64 ä½ï¼‰æ˜¯åŸºäºå•ç²¾åº¦ï¼ˆ32 ä½ï¼‰è€Œè¨€ã€‚

æœ€å¤§æœ€å°å€¼åˆ†åˆ«ä¸ºï¼š

```javascript
Number.MIN_SAFE_INTEGER = -(2 ** 53 - 1);
Number.MAX_SAFE_INTEGER = 2 ** 53 - 1;
```

#### window.isNaN ä¸ Number.isNaN

Number æ˜¯æ–°æ¥çš„ï¼Œåˆ¤æ–­æ›´è´´åˆå­—é¢æ„æ€ï¼Œå°±æ˜¯åˆ¤æ–­æ­¤å€¼æ˜¯ä¸æ˜¯ NaNã€‚è€Œ window.isNaN åœ¨åˆ¤æ–­å‰ä¼šè¿›è¡Œæ•°å­—è½¬æ¢ä¸€æ¬¡ï¼Œçœ‹æ­¤å€¼åˆ°åº•èƒ½ä¸èƒ½å½“æˆæ•°å­—ä½¿ç”¨ã€‚

#### è¿›åˆ¶è½¬æ¢

`0b`å¼€å¤´äºŒè¿›åˆ¶ï¼Œ`0x`å¼€å¤´ 16 è¿›åˆ¶ã€‚

- 10 è¿›åˆ¶è½¬ n è¿›åˆ¶ï¼Œ`Number.prototype.toString([radix])`
- n è¿›åˆ¶è½¬ 10 è¿›åˆ¶ï¼Œ`window.parseInt(string, radix)`
- Array è½¬ä¸ºæ•°å­—æ—¶ï¼Œç©ºæ•°ç»„ -> 0ï¼Œ`[1]` -> 1ï¼Œå¤šä¸ªçš„ä¸º NaN
- false -> 0ï¼Œ`''` -> 0

### Symbol

è¡¨ç¤ºä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œç›´æ¥ä½¿ç”¨ä¸å¸¦ new çš„æ„é€ å‡½æ•°ç”Ÿæˆã€‚

### Object

#### å±æ€§ç§ç±»

- accessor properties è®¿é—®å™¨å±æ€§ï¼Œget/set æ–¹æ³•
- data properties æ•°æ®å±æ€§
- internal properties å†…éƒ¨å±æ€§ï¼Œä¸å¯è§ä¸”æ— åï¼Œä¾‹å¦‚ï¼š[[Prototype]]ã€[[Extensible]]ã€[[DefineOwnProperty]]ã€[[Put]]ï¼ˆèµ‹å€¼è¿ç®—ç¬¦=æ‰€è°ƒç”¨çš„æ–¹æ³•ï¼‰

#### `Object.defineProperty(o, p, descriptor)`

å®šä¹‰å¯¹è±¡ o çš„å±æ€§ pï¼Œå¹¶è¿”å›å¯¹è±¡ oã€‚

##### descriptor

- å…¬å…±æè¿°ç¬¦
  - `configurable`(false)èƒ½å¦é…ç½®ä»¥åŠè¢«åˆ é™¤ï¼ˆå…·ä½“å½±å“è§ä¸‹æ–‡ï¼‰
  - `enumerable`(false) èƒ½å¦æšä¸¾
- æ‹©å…¶ä¸€
  - data descriptor
    - `value`(undefined)
    - `writable`(false) è¯¥å€¼æ˜¯å¦èƒ½å¤Ÿè¢«æ›´æ”¹ï¼ˆåªè®¾ç½®æ­¤å€¼åªèƒ½é™åˆ¶èµ‹å€¼è¿ç®—ç¬¦æ›´æ”¹ï¼Œæƒ³å®Œå…¨é™åˆ¶éœ€è¦ç»“åˆ configurable å±æ€§ï¼‰
  - accessor descriptor
    - `get`(undefined)
    - `set`(undefined)

##### `configurable`

é…ç½®ä¸º false æ—¶ï¼Œå³ï¼š

1. ä¸èƒ½åˆ é™¤å±æ€§ p
2. ä¸èƒ½é‡æ–°é…ç½®å±æ€§ pï¼Œä½†æœ‰ä¾‹å¤–ï¼š
   1. writable ä¸º true æ—¶ï¼Œé…ç½® value
   2. writable ä¸º true æ—¶ï¼Œé…ç½® writable
3. ä¸èƒ½æ•°æ®æè¿°ç¬¦ä¸è®¿é—®å™¨æè¿°ç¬¦ä¹‹é—´äº’è½¬

> æ‰€è°“ä¸èƒ½é‡æ–°é…ç½®ï¼Œå¹¶ä¸æ˜¯ä¸èƒ½å†æ¬¡è°ƒç”¨ï¼Œåªè¦è¿™æ¬¡è°ƒç”¨çš„å‚æ•°å€¼ä¸ configurable ä¸º false æ—¶å½“å‰çš„ descriptor çš„å±æ€§ä¸å†²çªï¼Œä¾ç„¶å¯ä»¥è°ƒç”¨ã€‚å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¾’åŠ³çš„ä¸¾åŠ¨ã€‚

2.2 çš„æ¥å†ï¼š

> There is one exception to this ruleâ€”JavaScript allows you to change an unconfigurable property from writable to read-only, for historic reasons; the property length of arrays has always been writable and unconfigurable. Without this exception, you wouldnâ€™t be able to freeze (see Freezing) arrays.

##### ä¸èµ‹å€¼è¿ç®—ç¬¦=çš„åŒºåˆ«

åŒºåˆ«ï¼š

1. åŸå¯¹è±¡ o æœ‰å±æ€§ pã€‚èµ‹å€¼è¿ç®—ç¬¦ä¼šè¢«è®¿é—®å™¨å±æ€§ä¸­çš„ setter å’Œæ•°æ®å±æ€§ä¸­çš„ writable:false æ§åˆ¶ï¼Œå°±æ­¤ç»“æŸã€‚è€Œå®šä¹‰æ˜¯æ ¹æ®ä¸€å®šçš„è§„åˆ™é‡æ–°é…ç½®åŸå±æ€§ã€‚
2. åŸå¯¹è±¡ o çš„åŸå‹æœ‰å±æ€§ pã€‚å¦‚æœå°†è¦æ“ä½œçš„å±æ€§ p æ˜¯æ¥è‡ªäºåŸå‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¼šè¢« setter å’Œ writable å½±å“ï¼Œè€Œå®šä¹‰ä¸ä¼šï¼ˆå°±ç®—åŸå‹çš„ p å±æ€§è¢«è®¾ç½®ä¸º configurable:false, writable:false ä¹Ÿä¸ä¼šï¼‰ã€‚
3. åŸå¯¹è±¡ o æ— å±æ€§ pã€‚æ‰§è¡Œæ–°å¢æ“ä½œï¼Œèµ‹å€¼è¿ç®—ç¬¦è™½ç„¶æ˜¯è°ƒç”¨[[Put]]è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯æœ€åä¸¤è€…éƒ½ä¼šæ®Šé€”åŒå½’è°ƒç”¨[[DefineOwnProperty]]ï¼ŒåŒºåˆ«åœ¨äºé»˜è®¤å€¼çš„è®¾ç½®ã€‚å‰è€…å…¨ä¸º trueï¼Œåè€…å…¨ä¸º falseã€‚

å…±åŒï¼š

1. åˆ›å»ºæ–°çš„å€¼æ—¶éƒ½ä¼šæ£€æµ‹å¯¹è±¡ o æ˜¯å¦æ˜¯éæ‰©å±•å¯¹è±¡ã€‚
   > æ‰©å±•å¯¹è±¡ï¼Œæ£€æŸ¥ç”¨ Object.isExtensible()ï¼Œè®¾ç½®ç”¨ Object.preventExtensions()ï¼Œæ³¨æ„ä¸å†»ç»“çš„åŒºåˆ«ã€‚

#### `Object.is`

ä¸`===`åŒºåˆ«ï¼š

- `+0` ä¸ `-0`ï¼Œ`===`è¿”å› trueï¼ŒObject.is è¿”å› false
- `NaN`ä¸`NaN`ï¼Œ`===`è¿”å› falseï¼ŒObject.is è¿”å› true

#### `Object.freeze()`

- å†»ç»“å¯¹è±¡ï¼Œåªæ˜¯é¦–å±‚å±æ€§çš„å†»ç»“ã€‚
- å†»ç»“è¿‡åï¼Œä¿®æ”¹æ•°æ®å¹¶ä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯ä¼šæ— æ•ˆã€‚
- å½“ç»§æ‰¿ä¸€ä¸ªå†»ç»“å¯¹è±¡æ—¶ï¼Œå¯¹å†»ç»“å¯¹è±¡é‡Œçš„å±æ€§æ“ä½œæ˜¯æ— æ•ˆçš„ï¼ˆæ­£å¸¸æƒ…å†µä¸‹çš„èµ‹å€¼ä¼šæ·»åŠ ä¸€ä¸ªè‡ªèº«å±æ€§ï¼‰ã€‚

#### å¯¹è±¡éå†

å¤è€çš„éå†æ–¹å¼ï¼Œè‡ªç„¶ä¸èƒ½éå†å‡º symbol å±æ€§ã€‚

- for inã€‚éå†è‡ªèº«å’ŒåŸå‹é“¾ä¸Šçš„å¯æšä¸¾å±æ€§ã€‚
  > åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œæ‰‹åŠ¨è®¾ç½®çš„ constructor ä¼šè¢«éå†å‡ºæ¥ï¼Œå¼•æ“è‡ªå·±è®¾ç½®çš„ä¸ä¼šè¢«éå†å‡ºæ¥ã€‚å› æ­¤è®°å¾—é…ç½® enumerable ä¸º falseã€‚

ä»¥ä¸‹æ˜¯æ–°çš„å±æ€§éå†æ–¹å¼ï¼Œéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ä¸å†éå†åŸå‹é“¾ä¸Šçš„å±æ€§ï¼Œè¿™æ ·æ›´ç¬¦åˆé€»è¾‘ã€‚

å…¶ä¸­ Object ä¸Šåˆ†é—¨åˆ«ç±»äº†å„ç§éå†ã€‚

- Object.keys()ã€Object.values()ã€Object.entries()ã€‚è‡ªèº«çš„å¯æšä¸¾å±æ€§ã€‚
- Object.getOwnPropertyNames()ã€‚è‡ªèº«çš„å¯æšä¸¾ä¸ä¸å¯æšä¸¾å±æ€§ã€‚
- Object.getOwnPropertySymbols()ã€‚è‡ªèº«çš„ symbol å±æ€§ã€‚

> symbol å±æ€§çš„å±æ€§æè¿°ç¬¦ä¸ºï¼šä¸å¯æšä¸¾ï¼Œä¸å¯é…ç½®ï¼Œä¸å¯é‡å†™ã€‚

æœ€ååœ¨å†…ç½®å¯¹è±¡ Reflect ä¸ŠæŒ‚è½½äº†ä¸€ä¸ªç»¼åˆçš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œä¾ç„¶ä¸å¯éå†åŸå‹é“¾çš„å±æ€§ã€‚

- Reflect.ownKeys()ã€‚è‡ªèº«çš„å¯æšä¸¾ã€ä¸å¯æšä¸¾ã€symbol å±æ€§ã€‚

å…¶ä»–éå†æ–¹æ³•ï¼š

- for ofï¼Œç”¨äºéå†å¯è¿­ä»£å¯¹è±¡ã€‚

#### éå†é¡ºåº

js å¼•æ“æœ¬èº«æ˜¯æ•£ä¹±æ— åºçš„ï¼Œæµè§ˆå™¨å®ç°æ—¶åŠ å…¥äº†è‡ªå·±çš„é¡ºåºè§„åˆ™ã€‚

- é¦–å…ˆéå†æ‰€æœ‰æ•°å€¼é”®ï¼ŒæŒ‰ç…§æ•°å€¼å‡åºæ’åˆ—ã€‚
- å…¶æ¬¡éå†æ‰€æœ‰å­—ç¬¦ä¸²é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—ã€‚
- æœ€åéå†æ‰€æœ‰ Symbol é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—ã€‚

### Array

- æ•°ç»„æ˜¯ç‰¹æ®Šçš„å¯¹è±¡ã€‚
- shift/unshift æ¯” pop/push æ€§èƒ½å·®å¾ˆå¤šï¼Œå°¤å…¶æ˜¯æ•°ç»„å¾ˆå¤§çš„æ—¶å€™å°¤ä¸ºæ˜æ˜¾ã€‚
- å…·æœ‰ç ´åçš„æ–¹æ³•ï¼šsortã€reverseã€splice/fill/pop/push/shift/unshiftã€‚

### reduce

`arr.reduce(callback(accumulator, currentValue[, index[, array]])[, initialValue])`

æ³¨æ„ç¬¬ 2 ä¸ªå‚æ•°ä¸ºå¯é€‰å‚æ•°ï¼Œä¸ä¼ æ—¶é»˜è®¤ä¸ºæ•°ç»„ç¬¬ 0 ä¸ªå…ƒç´ ã€‚

### sort

é»˜è®¤æŒ‰ç…§å‡åº ascending é¡ºåºå°±åœ°ï¼ˆin placeï¼‰æ’åˆ—ï¼Œä¼šå°†å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå†æŒ‰ç…§ utf-16 ç¼–ç å•å…ƒå€¼æ’åˆ—ã€‚

ä¸ç¨³å®šçš„ï¼Œä½†æ˜¯ ES10 è§„å®šä¹‹åç¨³å®šã€‚

callback æ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ’å‰é¢å°±è¿”å›è´Ÿæ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ’å‰é¢å°±è¿”å›æ­£æ•°ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºéœ€è¦ä¼ å…¥çš„ä¸¤ä¸ªå€¼äº¤æ¢ä½ç½®æ—¶å°±éœ€è¦è¿”å›ä¸€ä¸ªæ­£æ•°ï¼Œç›¸ç­‰å°±éœ€è¦è¿”å› 0ã€‚

### `Array.isArray()`

è¯¥ api åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯ Array ç±»çš„å®ä¾‹æˆ–è€…æ˜¯ä»¥ class æ–¹å¼ç»§æ‰¿çš„å­ç±»å®ä¾‹ï¼Œè‡ªè¡Œä½¿ç”¨ç»„åˆå¯„ç”Ÿæ–¹æ³•ç»§æ‰¿çš„å®ä¾‹ï¼Œä¸åœ¨èŒƒå›´ä¹‹å†…ã€‚

```js
// Array.isArray(arr) === true
class MyArray extends Array {}

// Array.isArray(arr) === false
function MyArray() {
  Array.apply(this, arguments);
}
MyArray.prototype = Object.create(Array.prototype);
```

### ç±»å‹è½¬æ¢

åŸºæœ¬ç±»å‹ä¸­åªæœ‰ Numberã€Stringã€Booleanã€Symbol å­˜åœ¨æ„é€ å‡½æ•°ï¼Œ
æœ‰å‡ æ¡è§„åˆ™æ³¨æ„ï¼š

- Number -> Booleanï¼Œ0/+0/-0/NaN ä¸º falseï¼Œå…¶ä½™ä¸º true åŒ…æ‹¬+Infinity/-Infinityã€‚
- String -> Boolean, åªæœ‰''ä¸º falseã€‚
- Symbol -> Number/Stringï¼ŒæŠ¥é”™
- Object -> Number/Stringï¼Œæ‹†ç®±è½¬æ¢ï¼Œè°ƒç”¨ valueOfã€toString æ–¹æ³•ï¼Œé‡åˆ°åŸºæœ¬ç±»å‹å°±åœæ­¢ï¼Œæœ€åæ— åŸºæœ¬ç±»å‹å°±æŠ¥é”™ï¼Œæœ‰äº†åŸºæœ¬ç±»å‹å†è½¬æ¢ä½ Number/Stringã€‚
  > è½¬æˆæ•°å­—æ—¶é¡ºåºä¸º valueOf å† toStringï¼Œè½¬æˆå­—ç¬¦ä¸²æ—¶ç›¸åã€‚æ³¨æ„ï¼Œ`n + ''`ä¸`n + 1`éƒ½æ˜¯å±äºè½¬æ•°å­—ä¼˜å…ˆï¼Œè°ƒç”¨é¡ºåºä¸º valueOf å† toStringã€‚

### ç±»å‹åˆ¤æ–­

- typeof æ“ä½œç¬¦ï¼š ç®€å•åˆ¤æ–­ç±»å‹ï¼Œæ— æ³•åŒºåˆ†ä¾‹å¦‚æ•°ç»„ä¸å¯¹è±¡ã€null ä¸å¯¹è±¡ã€‚
- instanceof æ“ä½œç¬¦/isPrototypeOf()ï¼š æµ‹è¯•å®ä¾‹ä¸åŸå‹é“¾ä¸­**å‡ºç°è¿‡**çš„æ„é€ å‡½æ•°ã€‚
  > å½“æ„é€ å‡½æ•°è¿”å›çš„æ˜¯å¼•ç”¨ç±»å‹æ—¶ï¼Œæ— æ³•åˆ¤æ–­ã€‚
- Object.prototype.toString.call(obj)ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›è¯¥å€¼çš„ class ç±»ï¼Œå³`[[class]]`ç§æœ‰å±æ€§ã€‚åœ¨æ—©æœŸï¼Œç”±äºè¯¥å±æ€§æ˜¯ä¸èƒ½æ›´æ”¹çš„ï¼Œæ‰€ä»¥è¿™æ ·åˆ¤æ–­å¾ˆå®‰å…¨ã€‚ä½†æ˜¯ï¼Œes6 åè¯¥å±æ€§è¢«`Symbol.toStringTag`æ‰€ä»£æ›¿ï¼Œå˜å¾—å¯ä»¥è¢«æ›´æ”¹ï¼Œå¦‚ä¸‹ï¼š

```javascript
var o = {
  [Symbol.toStringTag]: "HelloKitty",
};

console.log(Object.prototype.toString.call(o)); // "[object HelloKitty]"
```

> å½“å˜é‡ä¸ºè£…ç®±ç±»å‹æ—¶ï¼Œéœ€è¦å†åŠ ä¸Š typeof åˆ¤æ–­æ˜¯å¦æ˜¯åŸºæœ¬ç±»å‹ã€‚

- obj.hasOwnProperty(key) åˆ¤æ–­ obj å®ä¾‹æœ‰æ²¡æœ‰ key å±æ€§

## å¯è¿­ä»£å¯¹è±¡

å®ç°äº†**å¯è¿­ä»£åè®®**çš„å¯¹è±¡å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚å³å®ç°äº†`[Symbol.iterator]`æ¥å£çš„å¯¹è±¡ã€‚

### è¿­ä»£å™¨åè®®

å¯è¿­ä»£åè®®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨å‡†å¤‡è¿­ä»£æ—¶ä¼šè¿›è¡Œè°ƒç”¨ï¼Œç”¨è¿”å›çš„è¿­ä»£å™¨ï¼Œè¿›è¡Œæ¯ä¸€æ¬¡è¿­ä»£è°ƒç”¨ next æ–¹æ³•è·å–æ¯ä¸€æ¬¡å¾—åˆ°çš„å€¼ã€‚

ä¹Ÿå°±æ˜¯è¯´`[Symbol.iterator]`å±æ€§è¦ä¹ˆæ˜¯ä¸€ä¸ªè‡ªè¡Œè¿”å›å¦‚ä¸‹è¿­ä»£å™¨çš„å‡½æ•°ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª generator å‡½æ•°ã€‚

```ts
type IteratorReturn = {
  next(): {
    done: boolean;
    value?: any;
  };
};
function iterator(): IteratorReturn;
```

### å†…ç½®å¯è¿­ä»£å¯¹è±¡

Stringã€Arrayã€TypedArrayã€Mapã€Setã€arguments

### æ¥å—å¯è¿­ä»£å¯¹è±¡çš„å†…ç½® api

- new Map([iterable])
- new WeakMap([iterable])
- new Set([iterable])
- new WeakSet([iterable])
- Promise.all(iterable)
- Promise.race(iterable)
- Array.from(iterable)

### éœ€è¦å¯è¿­ä»£å¯¹è±¡çš„è¯­æ³•

for...of å¾ªç¯ã€å±•å¼€è¯­æ³•ã€yield \*ã€è§£æ„èµ‹å€¼

## Map

ä¿å­˜é”®å€¼å¯¹ã€‚

- èƒ½å¤Ÿè®°ä½é”®çš„åŸå§‹æ’å…¥é¡ºåº
- ä»»ä½•å€¼éƒ½å¯ä»¥ä½œä¸ºé”®å€¼
- æ˜¯ iterable çš„ï¼Œå¯ä»¥ç›´æ¥è¢«è¿­ä»£
- åœ¨é¢‘ç¹å¢åˆ é”®å€¼å¯¹çš„åœºæ™¯ä¸‹è¡¨ç°æ›´å¥½

## WeakMap

ä¸ map çš„åŒºåˆ«ï¼š

- åªèƒ½ä½¿ç”¨å¼•ç”¨ç±»å‹ä½œä¸º key
- key ä¿å­˜çš„æ˜¯å¼±å¼•ç”¨ï¼Œä¼šç›´æ¥è¢« gc å›æ”¶ï¼Œå› æ­¤ä¸èƒ½éå† WeakMap çš„ key

åœ¨ shim ä¸­è¢«ç”¨äºç±»çš„ç§æœ‰å˜é‡`#`çš„å®ç°ã€‚

```javascript
class Foo {
  constructor(p) {
    this.#p = p
  },

  fn() {
    console.log(this.#p)
  }
}

// è½¬æ¢åä»£ç 
var __classPrivateFieldSet = (receiver, privateMap, value) => privateMap.set(receiver, value);
var __classPrivateFieldGet = (receiver, privateMap) => privateMap.get(receiver);

var _p;
class Foo {
  constructor(p) {
    _p.set(this, void 0)
    __classPrivateFieldSet(this, _p, p)
  }

  fn() {
    console.log(__classPrivateFieldGet(this, _p))
  }
}
_p = new WeakMap();
```

> åœ¨ ts ä¸­ï¼Œ#ç§æœ‰å˜é‡ä¸ private çš„åŒºåˆ«åœ¨äºï¼Œprivate åªæ˜¯ ts å†…å®šçš„ï¼Œå…¶å®è½¬æ¢åä»£ç æ— å˜åŒ–ï¼Œåœ¨ç»§æ‰¿ä¸­ç›¸åŒçš„ private å˜é‡ä¼šè¢«è¦†ç›–ï¼Œè€Œ#ç§æœ‰å˜é‡è·Ÿ**å½“å‰ç±»**è·Ÿ**å®ä¾‹**æŒ‚é’©ï¼Œä¸ä¼šè¢«è¦†ç›–ï¼Œå§‹ç»ˆæ˜¯å–çš„å½“å‰ç±»ä¸­çš„å˜é‡ã€‚

## è¿ç®—ç¬¦ä¼˜å…ˆçº§

è¿™é‡Œåªåˆ—å‡ºæ˜“æ··é¡ºåº

- æˆå‘˜è®¿é—®ç±»ï¼š
  - `.`è®¿é—®
  - `[]`è®¿é—®
  - `new F()`**new è¿ç®—å¸¦å‚æ•°åˆ—è¡¨**
  - `F()`å‡½æ•°è°ƒç”¨
  - `?.` å¯é€‰é“¾
- `new F`**new è¿ç®—æ— å‚æ•°åˆ—è¡¨**
- `&&`
- `||`
- ä¸‰å…ƒè¿ç®—ç¬¦`? :`
- èµ‹å€¼ç±»è¿ç®—ç¬¦`=`

## éšå¼è½¬æ¢

### è¿ç®—ç¬¦éšå¼è½¬æ¢

#### å‡`-`ä¹˜`*`é™¤`/`

å°½é‡éƒ½è½¬ numberï¼Œä¸è¡Œå°±è¿”å›`NaN`

- è½¬æ¢è§„åˆ™ï¼Œnull -> 0ï¼Œtrue -> 1ï¼Œfalse -> 0ï¼Œundefined -> NaNï¼Œæ•°ç»„ -> string -> number -> NaNï¼ˆä¸€æ­¥æ­¥å°è¯•ï¼‰ï¼Œå¯¹è±¡ -> NaNï¼Œ'' -> 0
- NaN, Infinity éƒ½æ˜¯ number ç±»å‹

```javascript
1 - true; // 0
1 - null; // 1
1 * undefined; // NaN
2 * ["5"]; // 10
2 * ["5", "5"]; // NaN
3 / ""; // Infinity
3 / []; // Infinity
```

> Symbol ä¼šæŠ¥é”™ï¼Œæ¯•ç«Ÿè¿™ç§éšå¼è½¬æ¢æ˜¯ä»¥å‰çš„ï¼ŒSymbol æ˜¯æ–°å‡ºçš„åŸå§‹ç±»å‹ã€‚

#### åŠ `+`

ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š

1. æœ‰å­—ç¬¦ä¸²å‡ºç°ï¼Œå…¨éƒ½è½¬æˆ string æ‹¼æ¥
2. number + åŸå§‹ç±»å‹ï¼ˆå…¶å®ä¹Ÿå°±åªå‰©ä¸‹ null/true/false/undefinedï¼‰ï¼Œæ­£å¸¸æ•°å­¦è¿ç®—
3. å«æœ‰å¼•ç”¨ç±»å‹ï¼Œè½¬æˆ string æ‹¼æ¥

#### ç­‰äºç¬¦`==`

ä¸¤æ¡ç‰¹ä¾‹è§„åˆ™ï¼š

- `NaN`ä¸ä»»ä½•ç±»å‹æ¯”è¾ƒï¼Œè¿”å› false
- `null`ï¼Œ`undefined`åªæœ‰äº’ç›¸æ¯”è¾ƒæ—¶æ‰è¿”å› trueï¼Œå…¶ä½™æƒ…å†µå‡è¿”å› false

è½¬æ¢è§„åˆ™ä¼˜å…ˆçº§ ï¼š
`boolean` > `å¼•ç”¨ç±»å‹` > `string` > `number`

ä¸€æ­¥æ­¥æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œè½¬æ¢ï¼Œæœ€ç»ˆéƒ½ä¼šå‘ number é é½ï¼Œå½“ç„¶é€”ä¸­å¦‚æœå·²ç»æ˜¯åŒç±»å‹äº†ï¼Œé‚£ä¹ˆè‡ªç„¶æ— éœ€å†è¿›è¡Œè½¬æ¢ï¼Œç›´æ¥æ¯”è¾ƒå³å¯ï¼Œå…¶ä¸­ï¼š

- `boolean`è¢«è½¬æ¢æˆ number
- å¼•ç”¨ç±»å‹ä¼šä½¿ç”¨ ToPrimitive è§„åˆ™ï¼ˆvalueOf/toString æ–¹æ³•ï¼‰è½¬æ¢æˆåŸå§‹ç±»å‹ï¼Œå†è¿›è¡Œä¼˜å…ˆçº§è½¬æ¢

> å¯¹äºæ•°ç»„ï¼Œ`[]`è½¬ä¸ºæ•°å­—`0`ï¼Œ`[1]`è½¬ä¸ºæ•°å­—`1`ï¼Œ`[1,2]`è½¬ä¸ºæ•°å­—`NaN`ã€‚

## æ‰§è¡Œä¸Šä¸‹æ–‡

å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼ŒJavaScript ä¼šç”Ÿæˆä¸€ä¸ªä¸è¿™ä¸ªæ–¹æ³•å¯¹åº”çš„æ‰§è¡Œç¯å¢ƒï¼Œåˆå«æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªæ‰§è¡Œç¯å¢ƒä¸­æœ‰è¿™ä¸ªæ–¹æ³•çš„ç§æœ‰ä½œç”¨åŸŸã€ä¸Šå±‚ä½œç”¨åŸŸçš„æŒ‡å‘ã€æ–¹æ³•çš„å‚æ•°ã€ç§æœ‰ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡ä»¥åŠ this å¯¹è±¡ã€‚è¿™ä¸ªæ‰§è¡Œç¯å¢ƒä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªå†…å­˜å¯¹è±¡æ ˆä¸­ï¼Œè¿™ä¸ªæ ˆå°±æ˜¯æ‰§è¡Œæ ˆã€‚

å¦‚æœåœ¨è¿™ä¸ªæ–¹æ³•çš„ä»£ç æ‰§è¡Œä¸­ï¼Œé‡åˆ°äº†å‡½æ•°è°ƒç”¨è¯­å¥ï¼Œé‚£ä¹ˆ JavaScript ä¼šç”Ÿæˆè¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒå¹¶å°†å…¶æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œç„¶åè¿›å…¥è¿™ä¸ªæ‰§è¡Œç¯å¢ƒæ¥æ‰§è¡Œå…¶ä¸­çš„å‡½æ•°ä»£ç ã€‚æ‰§è¡Œå®Œæ¯•åï¼ŒJavaScript ä¼šé€€å‡ºæ‰§è¡Œç¯å¢ƒå¹¶æŠŠè¿™ä¸ªæ‰§è¡Œç¯å¢ƒä»æ ˆä¸­é”€æ¯ï¼Œå›åˆ°ä¸Šä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œç¯å¢ƒã€‚

æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨ ES3 ä¸­ï¼ŒåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ã€‚

- scopeï¼šä½œç”¨åŸŸï¼Œä¹Ÿå¸¸å¸¸è¢«å«åšä½œç”¨åŸŸé“¾ã€‚
- variable objectï¼šå˜é‡å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å˜é‡çš„å¯¹è±¡ã€‚
- this valueï¼šthis å€¼ã€‚

åœ¨ ES5 ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†å‘½åæ–¹å¼ï¼ŒæŠŠæ‰§è¡Œä¸Šä¸‹æ–‡æœ€åˆçš„ä¸‰ä¸ªéƒ¨åˆ†æ”¹ä¸ºä¸‹é¢è¿™ä¸ªæ ·å­ã€‚

- lexical environmentï¼šè¯æ³•ç¯å¢ƒï¼Œå½“è·å–å˜é‡æ—¶ä½¿ç”¨ã€‚
- variable environmentï¼šå˜é‡ç¯å¢ƒï¼Œå½“å£°æ˜å˜é‡æ—¶ä½¿ç”¨ã€‚
- this valueï¼šthis å€¼ã€‚

> for å¾ªç¯ä¸­å¦‚æœä½ ä½¿ç”¨äº† let è€Œä¸æ˜¯ varï¼Œlet çš„å˜é‡é™¤äº†ä½œç”¨åŸŸæ˜¯åœ¨ for åŒºå—ä¸­ï¼Œè€Œä¸”ä¼šä¸ºæ¯æ¬¡å¾ªç¯æ‰§è¡Œå»ºç«‹æ–°çš„è¯æ³•ç¯å¢ƒ(LexicalEnvironment)ï¼Œæ‹·è´æ‰€æœ‰çš„å˜é‡åç§°ä¸å€¼åˆ°ä¸‹ä¸ªå¾ªç¯æ‰§è¡Œã€‚

åœ¨ ES2018 ä¸­ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡åˆå˜æˆäº†è¿™ä¸ªæ ·å­ï¼Œthis å€¼è¢«å½’å…¥ lexical environmentï¼Œä½†æ˜¯å¢åŠ äº†ä¸å°‘å†…å®¹ã€‚

- lexical environmentï¼šè¯æ³•ç¯å¢ƒï¼Œå½“è·å–å˜é‡æˆ–è€… this å€¼æ—¶ä½¿ç”¨ã€‚
- variable environmentï¼šå˜é‡ç¯å¢ƒï¼Œå½“å£°æ˜å˜é‡æ—¶ä½¿ç”¨ã€‚
- code evaluation stateï¼šç”¨äºæ¢å¤ä»£ç æ‰§è¡Œä½ç½®ã€‚
- Functionï¼šæ‰§è¡Œçš„ä»»åŠ¡æ˜¯å‡½æ•°æ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºæ­£åœ¨è¢«æ‰§è¡Œçš„å‡½æ•°ã€‚
- ScriptOrModuleï¼šæ‰§è¡Œçš„ä»»åŠ¡æ˜¯è„šæœ¬æˆ–è€…æ¨¡å—æ—¶ä½¿ç”¨ï¼Œè¡¨ç¤ºæ­£åœ¨è¢«æ‰§è¡Œçš„ä»£ç ã€‚
- Realmï¼šä½¿ç”¨çš„åŸºç¡€åº“å’Œå†…ç½®å¯¹è±¡å®ä¾‹ã€‚
- Generatorï¼šä»…ç”Ÿæˆå™¨ä¸Šä¸‹æ–‡æœ‰è¿™ä¸ªå±æ€§ï¼Œè¡¨ç¤ºå½“å‰ç”Ÿæˆå™¨ã€‚

> Realm å³é¢†åŸŸï¼Œå›½åº¦çš„æ„æ€ã€‚ä¾‹å¦‚ä¸¤ä¸ªä¸åŒ iframe å±äºä¸åŒçš„ realmï¼Œæ­¤æ—¶ä¸€äº›å¯¹è±¡å¹¶ä¸æ˜¯å…±ç”¨çš„ã€‚

```javascaript
var iframe = document.createElement('iframe')
document.documentElement.appendChild(iframe)
iframe.src="javascript:var b = {};"
var b1 = iframe.contentWindow.b;
var b2 = {};
console.log(typeof b1, typeof b2); //undefined object
console.log(b1 instanceof Object, b2 instanceof Object); //false true
```

### ä½œç”¨åŸŸæå‡

æµè§ˆå™¨çš„çš„å®ç°ä¿ç•™äº†ä»¥å‰çš„æ—§çš„è§„åˆ™ï¼ˆä¸ºäº†å…¼å®¹æ€§è€ä»£ç ï¼‰ï¼ŒåˆåŠ å…¥äº†æ–°çš„è§„åˆ™ã€‚

è¿™é‡Œå¼•å…¥ä¸¤ä¸ªæ¦‚å¿µï¼Œæ—§ä¸–ç•Œä½œç”¨åŸŸï¼š**å‡½æ•°ä½œç”¨åŸŸ**å’Œ**å…¨å±€ä½œç”¨åŸŸ**ï¼ˆä»”ç»†ä¸€æƒ³å…¶å®å°±ä¸€ä¸ªï¼‰ã€‚æ–°ä¸–ç•Œä½œç”¨åŸŸï¼šæ—§ä¸–ç•Œä¸ŠåŠ ä¸€ä¸ª**å—çº§ä½œç”¨åŸŸ**ã€‚

#### var å˜é‡

å®šä¹‰ä¼šæå‡åˆ°æ—§ä¸–ç•Œä½œç”¨åŸŸé¡¶éƒ¨ï¼Œä½†ä¼˜å…ˆçº§æ²¡æœ‰å‡½æ•°é«˜ã€‚

å¾…åˆ°å®é™…å®šä¹‰å¤„æ‰è¿›è¡Œèµ‹å€¼ã€‚

ç¤ºä¾‹ 1ï¼š

```js
console.log(a); // f a() {}

var a = 3;

function a() {}
```

ç¤ºä¾‹ 2ï¼š

```js
var b;
void (function () {
  var env = { b: 1 };
  b = 2; // è¿™é‡Œå®é™…ä¸Šæ˜¯å¯¹var b = 3æå‡ä¸Šæ¥çš„bè¿›è¡Œèµ‹å€¼
  console.log("In function b:", b); // 2
  with (env) {
    var b = 3;
    console.log("In with b:", b); // 3
  }
})();
console.log("Global b:", b); // undefined
```

#### let/const

æ²¡æœ‰å˜é‡æå‡ã€‚ä¸èƒ½é‡å¤ä¹Ÿä¸èƒ½æå‰ä½¿ç”¨ï¼ˆè¿`typeof`ä¹Ÿä¸èƒ½ä½¿ç”¨ï¼‰ã€‚åœ¨å½“å‰ä½œç”¨åŸŸå†…ä¼šè¿›è¡Œâ€œä¸€å®¶ç‹¬å¤§â€ï¼Œå°±ç®—ä½ åœ¨å…¨å±€ä¸Šæ‹¥æœ‰è¿™ä¸ªå˜é‡ï¼Œä¹Ÿä¸èƒ½æå‰ä½¿ç”¨ã€‚ä¹Ÿå«æš‚æ—¶æ€§æ­»åŒºã€‚

```js
var a = 4;
{
  typeof a; // Uncaught ReferenceError: Cannot access 'a' before initialization
  console.log(a); // Uncaught ReferenceError: Cannot access 'a' before initialization
  let a = 3;
}
```

æ³¨æ„å¸¸åœ¨å‡½æ•°é»˜è®¤å‚æ•°è®¾ç½®ä¸­çš„æ­»åŒºï¼š

```js
// p2è¿˜æœªå®šä¹‰å°±ä½¿ç”¨äº†
// Uncaught ReferenceError: Cannot access 'p2' before initialization
const fn1 = (p1 = p2, p2 = 3) => {};
fn1();

const fn2 = (p1 = 3, p2 = p1) => {};
fn2();
```

for å¾ªç¯ä¸­ï¼Œå£°æ˜å—ä¸æ‰§è¡Œå—æ˜¯ä¸åŒçš„ä½œç”¨åŸŸï¼Œé€šè¿‡ä»¥ä¸‹ç¤ºä¾‹å¯å¾—å‡ºç»“è®ºã€‚

```js
for (let i = 0; i < 3; i++) {
  let i = "abc";
  console.log(i);
}
// abc æœªæŠ¥ä¸èƒ½å†æ¬¡å£°æ˜é”™è¯¯
// abc
// abc
```

#### å‡½æ•°å£°æ˜

ç¨æ˜¾å¤æ‚ï¼Œå¤§æ¦‚è§„åˆ™ï¼š

- è§„åˆ™ 1ï¼šå‡½æ•°å£°æ˜çš„å®šä¹‰ï¼Œå°±æ˜¯æŒ‡å…·åå‡½æ•°å˜é‡çš„å®šä¹‰ä¼šæå‡åˆ°æœ€è¿‘çš„æ—§ä¸–ç•Œä½œç”¨åŸŸã€‚
- è§„åˆ™ 2ï¼šå‡½æ•°å£°æ˜çš„å®ä½“ï¼Œå³èµ‹å€¼æ“ä½œï¼Œä¼šåœ¨æœ€è¿‘çš„æ–°ä¸–ç•Œä½œç”¨åŸŸä¸­èµ‹å€¼ã€‚

ç¤ºä¾‹ 1ï¼š

```js
if (true) {
  function f() {}
}

console.log(f); //ï¼Ÿ
```

å³:

```js
var f;
if (true) {
  f = function () {};
}

console.log(f); //Æ’ f() {}
```

ç¤ºä¾‹ 2ï¼š

```js
function f() {
  console.log("f1");
}

(function () {
  if (true) {
    function f() {
      console.log("f2");
    }
  }
  f(); // ï¼Ÿ
})();

f(); // ï¼Ÿ
```

å³ï¼š

```js
var f = (function () {
  console.log("f1");
})(function () {
  var f;
  if (true) {
    f = function () {
      console.log("f2");
    };
  }
  f(); // "f2"
})();

f(); // "f1"
```

ç¤ºä¾‹ 3ï¼š

```js
console.log(fn); // ?
fn(); // ?
{
  fn(); // ?
  function fn() {
    console.log("hello");
  }
  fn(); // ?
}
fn(); // ?
```

å³ï¼š

```js
var fn; // è§„åˆ™1
console.log(fn); //undefined
fn(); // æŠ¥é”™ fn is not fucntion
{
  fn = function () {
    console.log("hello");
  }; // è§„åˆ™2
  fn(); //hello
  fn(); //hello
}
fn(); //hello
```

???ç¤ºä¾‹ 4ï¼š

```js
{
  function foo() {}
  foo = 1;
  function foo() {}
  foo = 2;
}
console.log(foo); // 1
```

ç¤ºä¾‹ï¼š
"å…·æœ‰åç§°çš„å‡½æ•°è¡¨è¾¾å¼"ä¼šåœ¨å¤–å±‚è¯æ³•ç¯å¢ƒå’Œå®ƒè‡ªå·±æ‰§è¡Œäº§ç”Ÿçš„è¯æ³•ç¯å¢ƒä¹‹é—´äº§ç”Ÿä¸€ä¸ªè¯æ³•ç¯å¢ƒï¼Œå†æŠŠè‡ªå·±çš„åç§°å’Œå€¼å½“ä½œå˜é‡å¡è¿›å»ã€‚

```javascript
var b = 10;
(function b() {
  b = 20;
  console.log(b); // [Function: b]
})();
```

æ‰€ä»¥è¿™é‡Œçš„ b = 20 å¹¶æ²¡æœ‰æ”¹å˜å¤–é¢çš„ bï¼Œè€Œæ˜¯è¯•å›¾æ”¹å˜ä¸€ä¸ªåªè¯»çš„å˜é‡ bã€‚

### é—­åŒ…

é—­åŒ…æ˜¯ä¸€ä¸ªç»‘å®šäº†æ‰§è¡Œç¯å¢ƒçš„å‡½æ•°ã€‚

è€Œè¿™ä¸ªæ‰§è¡Œç¯å¢ƒä½ å¯èƒ½ä¸æƒ³ä¸ä»»ä½•å…¶ä»–æ‰§è¡Œç¯å¢ƒå…±äº«ï¼Œå› æ­¤è‡ªå·±ç»‘å®šäº†ä¸€ä¸ªç§æœ‰çš„æ‰§è¡Œç¯å¢ƒã€‚

### this

è·å–å‡½æ•°çš„è¡¨è¾¾å¼ï¼Œå®ƒå®é™…ä¸Šè¿”å›çš„å¹¶éå‡½æ•°æœ¬èº«ï¼Œè€Œæ˜¯ä¸€ä¸ª Reference ç±»å‹ï¼Œå®ƒç”±ä¸€ä¸ªå¯¹è±¡å’Œä¸€ä¸ªå±æ€§å€¼æ„æˆã€‚

### å˜é‡å¯¹è±¡

è·Ÿæ‰§è¡Œä¸Šä¸‹æ–‡ç›¸å…³çš„ä¸€ä¸ªéšå¼å¯¹è±¡ã€‚åŒ…å«ï¼š

- å˜é‡å£°æ˜ï¼ˆVariableDeclarationï¼‰
- å‡½æ•°å£°æ˜ï¼ˆFunctionDeclarationï¼‰
- å½¢å‚

#### å…¨å±€å¯¹è±¡

VO === this === global

åœ¨æµè§ˆå™¨ä¸­ï¼Œå…¨å±€å¯¹è±¡çš„ window å±æ€§æŒ‡å‘äº†å…¨å±€å¯¹è±¡ï¼Œè€Œä¸æ˜¯ window å°±æ˜¯å…¨å±€å¯¹è±¡ï¼Œå¦‚ä¸‹:

```javascript
global = {
  Math: <...>,
  String: <...>
  ...
  ...
  window: global
};
```

> åœ¨å…¨å±€ä¸Šï¼Œå˜é‡å£°æ˜ä¸æœªå£°æ˜çš„åŒºåˆ«åœ¨äºï¼Œå£°æ˜çš„å˜é‡ä¸èƒ½è¢« delete åˆ é™¤ï¼ˆeval ä¸­å®šä¹‰çš„å¯ä»¥åˆ é™¤ï¼‰ï¼Œè€Œå› ä¸ºæœªå£°æ˜è¢«æŒ‚è½½åˆ° global çš„å˜é‡å¯ä»¥åˆ é™¤ã€‚

#### å‡½æ•°ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡

VO === AO

```javascript
AO = {
  arguments: {
    callee: å½“å‰å‡½æ•°çš„å¼•ç”¨,
    length: å®å‚çš„ä¸ªæ•°ï¼Œ
    properties-indexesï¼š
  }
};
```

arguments å¯¹è±¡çš„ properties-indexes çš„å€¼ä¸å½“å‰ï¼ˆå®é™…ä¼ é€’çš„ï¼‰å½¢å‚æ˜¯å…±äº«çš„ï¼Œä¿®æ”¹ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªè·Ÿç€å˜ï¼Œä½†æ˜¯æœªä¼ å…¥çš„å‚æ•°ä¸å…±äº«ã€‚ä¾‹å¦‚å‡½æ•°å½¢å‚ 3 ä¸ªï¼Œå®å‚ 2 ä¸ªï¼Œé‚£ä¹ˆ arguments[2]ä¸ z å„æ˜¯ä¸ªçš„å€¼ï¼Œè€Œ arguments[0]ä¸ x åˆ™å…±äº«ã€‚

#### å¤„ç†ä¸Šä¸‹æ–‡ä»£ç çš„ 2 ä¸ªé˜¶æ®µ

1. è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ä¾ä»£ç é¡ºåºåœ¨å˜é‡å¯¹è±¡ä¸Šå¡«å……å±æ€§ï¼Œå¯¹äºå‡½æ•°å£°æ˜ï¼Œç›´æ¥å¢åŠ  key èµ‹å€¼ valueï¼Œå¹¶ä¸”é‡åæ›¿æ¢ã€‚å¯¹äºå½¢å‚ä¸å˜é‡å£°æ˜ï¼Œå¢åŠ  key èµ‹å€¼ undefinedï¼Œä½†æ˜¯é‡åå¿½ç•¥ã€‚
2. æ‰§è¡Œä»£ç 

## è¯­å¥

### æ™®é€šè¯­å¥

- å£°æ˜ç±»è¯­å¥ï¼ˆvar/const/let/function/classï¼‰
- è¡¨è¾¾å¼è¯­å¥
- ç©ºè¯­å¥
- with è¯­å¥
- debugger è¯­å¥

### è¯­å¥å—

### æ§åˆ¶å‹è¯­å¥

if/switch/for/while/continue/break/return/throw/try

åœ¨å„ç§æ§åˆ¶è¯­å¥ç»„åˆä¸­ï¼Œæœ‰å¦‚ä¸‹æƒ…å†µï¼š

- äº§ç”Ÿâ€œæ¶ˆè´¹çš„â€ï¼š
  - switch + break
  - for/while + break
  - for/while + continue
  - function + return
  - try + throw
- äº§ç”ŸæŠ¥é”™çš„
  - function + break
  - function + continue
- ç‰¹æ®Šå¤„ç†çš„ï¼Œtry/catch/finally + break/continue/return
  > è¿™é‡Œçš„ç‰¹æ®Šå¤„ç†æŒ‡çš„æ˜¯ï¼Œtry/catch çš„é normal å‹å®Œæˆè®°å½•å¹¶ä¸ä¼šç«‹å³è¿”å›ï¼Œè€Œæ˜¯è¿˜è¦åŠ ä¸Š finally çš„å®Œæˆè®°å½•ä¸€èµ·åˆ¤æ–­ã€‚
- å…¶ä½™å‡ç©¿é€

### å¸¦æ ‡ç­¾çš„è¯­å¥

å½¢å¦‚`hello: var a = 3`ï¼Œå†’å·å‰é¢çš„å­—ç¬¦ä¸²ç”¨äºè®¾å®šâ€œå®Œæˆè®°å½•ç±»å‹ Completion Recordâ€çš„[[target]]å­—æ®µï¼Œä¸»è¦ç”¨äºä»¥æŒ‡å®šæ–¹å¼è·³å‡ºå¤šé‡å¾ªç¯ã€‚

ä¾‹å¦‚`break hello`ä¼šäº§ç”Ÿå¸¦æœ‰[[target]]ä¸º hello çš„å®Œæˆè®°å½•ï¼Œé‚£ä¹ˆåªæœ‰å¸¦æœ‰ hello çš„æ ‡ç­¾æ‰èƒ½â€œæ¶ˆè´¹â€å®ƒã€‚

## switch

- ç”¨å…¨ç­‰æ¯”å¯¹ switch ä¼ å…¥çš„è¡¨è¾¾å¼å€¼ä¸ case åé¢çš„è¡¨è¾¾å¼å€¼ï¼Œtrue å°±æ‰§è¡Œ case ä¸‹é¢çš„ä»£ç ï¼Œfalse åˆ™æ‰¾å¯» default ä»£ç ã€‚
- ä¸€æ—¦ä»£ç å¼€å§‹æ‰§è¡Œï¼ˆåŒ…æ‹¬ case çš„ä»£ç æˆ–è€… default çš„ä»£ç ï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç¢°åˆ° breakï¼Œä¸ç®¡åé¢çš„ case æ¡ä»¶ï¼Œä¸€å¾‹ç›´æ¥æ‰§è¡Œã€‚

## `bind`æ–¹æ³•

- bind ä¼šäº§ç”Ÿä¸€ä¸ª**æ–°æ–¹æ³•**ï¼Œæ–¹æ³•åä¸º`bound åŸå‡½æ•°å`
- `bind`ä¼ é€’çš„å‚æ•°ä¼˜å…ˆçº§æ¯”åŸå‡½æ•°é«˜ï¼Œä¸”åæ¥çš„å‚æ•°æ˜¯ç´§è·Ÿç€`bind`å‚æ•°çš„åé¢ï¼Œè€Œä¸æ˜¯å¯¹ä½å–ä»£
- bind è¿”å›çš„å‡½æ•°å¯ä»¥é€šè¿‡ new è°ƒç”¨ï¼Œè¿™æ—¶æä¾›çš„ this çš„å‚æ•°è¢«å¿½ç•¥ï¼ŒæŒ‡å‘äº† new ç”Ÿæˆçš„å…¨æ–°å¯¹è±¡ã€‚å†…éƒ¨æ¨¡æ‹Ÿå®ç°äº† new æ“ä½œç¬¦

### æ‰‹å†™ bind

1. è¿”å›`bound`æ–¹æ³•
2. é€šè¿‡`this instanceof bound`æ¥å†³å®šæ˜¯å¦æ¨¡æ‹Ÿ new æ“ä½œç¬¦
3. è°ƒæ•´è¿”å›æ–¹æ³•çš„`name`ä¸å‚æ•°çš„`length`

## Class

### å®šä¹‰

ç±»ï¼ˆClassï¼‰ä¸º JavaScript åŸå‹çš„è¯­æ³•ç³–ã€‚

- åŸå‹çš„æ„é€ å‡½æ•°ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨`class`å…³é”®å­—å£°æ˜ã€‚
- åŸå‹çš„ç»§æ‰¿ï¼Œä¹‹å‰ä½¿ç”¨æ‰‹åŠ¨è®¾ç½® prototypeï¼Œè¿™é‡Œä½¿ç”¨`extends`å…³é”®å­—ã€‚

åœ¨ react ä¸­ç»å¸¸ä¼šç”¨åˆ°=ç¬¦å·è®¾ç½®å±æ€§ï¼Œè½¬åŒ–ä¸º es5 çš„è¿‡ç¨‹ç¨æœ‰åŒºåˆ«ï¼Œ=ç¬¦å·è®¾ç½®çš„å®ä¾‹å±æ€§æ˜¯ç›´æ¥æŒ‚è½½åœ¨ç”Ÿæˆçš„å®ä¾‹å±æ€§ä¸Šï¼Œè€Œæ„é€ å‡½æ•°é‡Œçš„å±æ€§åˆ™æ˜¯æŒ‚è½½åœ¨ç±»çš„ prototype å¯¹è±¡ä¸Šã€‚ç±»çš„å±æ€§è®¾ç½®åŒºåˆ«ä¸å¤§ã€‚

```javascript
class Cat {
  constructor(name) {
    this.name = name;
  }

  fn = () => {
    console.log('from "=" setting', this);
  };

  fn2 = function () {
    console.log(this);
  };
  name = 3;

  fn() {
    console.log('from "()" setting', this);
  }

  static s = 1;
  static sfn() {
    console.log('from "()" setting', this);
  }
  static sfn = () => {
    console.log('from "=" setting', this);
  };
}
```

è½¬åŒ–å

```javascript
function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true,
    });
  } else {
    obj[key] = value;
  }
  return obj;
}

var Cat = /*#__PURE__*/ (function () {
  "use strict";

  function Cat(name) {
    var _this = this;

    _defineProperty(this, "fn", function () {
      console.log('from "=" setting', _this);
    });

    _defineProperty(this, "fn2", function () {
      console.log(this);
    });

    _defineProperty(this, "name", 3);

    this.name = name;
  }

  var _proto = Cat.prototype;

  _proto.fn = function fn() {
    console.log('from "()" setting', this);
  };

  Cat.sfn = function sfn() {
    console.log('from "()" setting', this);
  };

  return Cat;
})();

_defineProperty(Cat, "s", 1);

_defineProperty(Cat, "sfn", function () {
  console.log('from "=" setting', Cat);
});
```

### ç»§æ‰¿

æœ€å¥½çš„ç»§æ‰¿çš„ç‰¹ç‚¹ï¼š

- èƒ½ç»™çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚
- å‡½æ•°å¤ç”¨ï¼Œå³çˆ¶ç±»å­ç±»åŸå‹ä¸Šçš„æ–¹æ³•è¦èƒ½åœ¨æ–°çš„å¯¹è±¡ä¸Šå¤ç”¨
- constructor èƒ½æ­£ç¡®æŒ‡å‘

#### åŸå‹é“¾ç»§æ‰¿

ä½¿ç”¨ new ç»§æ‰¿ï¼Œå¯¼è‡´äº†è¶…ç±»çš„å®ä¾‹å±æ€§å˜æˆäº†å­ç±»çš„åŸå‹å±æ€§ã€‚

```javascript
function SubType() {}
SubType.prototype = new SuperType();
```

#### å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ï¼ˆconstructor stealingï¼‰

ä½¿ç”¨ call/applyï¼Œå¯¼è‡´äº†ä¸èƒ½å¤ç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚

```javascript
function SubType() {
  SuperType.call(this);
}
```

#### ç»„åˆç»§æ‰¿ï¼ˆconbination inheritanceï¼‰

ç»“åˆåŸå‹é“¾ç»§æ‰¿ä¸å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ã€‚

#### åŸå‹å¼ç»§æ‰¿ï¼ˆprototypal inheritanceï¼‰

å³ es5 çš„ Object.create()æ–¹æ³•ã€‚éœ€è¦ä¸€ä¸ªåŸºç¡€å¯¹è±¡ï¼Œæ¥åˆ›å»ºå¦ä¸€ä¸ªç±»ä¼¼çš„å¯¹è±¡ã€‚

è¿™ç§ç»§æ‰¿å®è´¨ä¸Šæ˜¯å¯¹ç±»ç»§æ‰¿çš„ä¸€ç§è¡¥å……ï¼Œå±äº**å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿**ï¼Œè€Œæ— éœ€å»åˆ›å»ºæŠ½è±¡ç±»ã€‚

```javascript
function object(o) {
  function F() {}
  F.prototype = o;
  return new F();
}
```

#### å¯„ç”Ÿå¼ç»§æ‰¿ï¼ˆparasitic inheritanceï¼‰

ä¸åŸå‹å¼ç»§æ‰¿ä¸€æ ·ï¼Œåªæ˜¯è¯´æŠŠè®¾ç½®æ–¹æ³•çš„è¿‡ç¨‹å•ç‹¬æäº†å‡ºæ¥ï¼Œä½†æœ¬è´¨ä¸Šâ€œæ–¹æ³•â€è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°å¤ç”¨ï¼ŒæŒ‚åœ¨äº†å®ä¾‹ä¸Šã€‚

```javascript
function createAnother(original) {
  var clone = Object.create(original);
  clone.sayHi = function () {
    alert("hi");
  };
  return clone;
}
```

#### å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

å±äºç±»ä¹‹é—´çš„ç»§æ‰¿ï¼Œåœ¨åŸå‹å¯¹è±¡çš„ç»§æ‰¿ä¸Šä½¿ç”¨ä¸Šé¢è®¨è®ºçš„ç»“æœï¼Œå³å¯„ç”Ÿå¼ã€‚åœ¨å®ä¾‹å±æ€§çš„ç»§æ‰¿ä¸Šï¼Œä½¿ç”¨â€œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿â€æ–¹å¼ã€‚

```javascript
SubType.prototype = object(SuperType.prototype);
Object.defineProperty(SubType.prototype, "constructor", {
  value: SubType,
});
```

> ç±»çš„é™æ€å±æ€§ç»§æ‰¿ï¼š`Object.setPrototypeOf(SubType, SuperType)`

### åŸå‹

åŸå‹ï¼Œå³`[[prototype]]`ã€‚ç›®å‰æœ€æ–°çš„æ“ä½œåŸå‹çš„æ–¹å¼å¦‚ä¸‹ï¼Œåœ¨æ—©æœŸæˆ‘ä»¬åªèƒ½ä½¿ç”¨ new ä¸€ä¸ªè¦ç»§æ‰¿çš„å®ä¾‹æ¥é“¾æ¥åŸå‹ï¼ˆ**proto**åœ¨ä¸ªæµè§ˆå™¨ä¸­ä¹Ÿæ²¡æ™®åŠå¼€æ¥ï¼‰ã€‚

- Object.createï¼Œæ ¹æ®æŒ‡å®šå¯¹è±¡ä¸ºåŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚
- Object.getPrototypeOfï¼Œè·å–åŸå‹
- Object.setPrototypeOfï¼Œè®¾ç½®åŸå‹

è¦äº§ç”Ÿä¸€ä¸ªå®ä¾‹ vï¼Œéœ€è¦ï¼š

1. èƒ½è®¾ç½® v çš„è‡ªæœ‰å±æ€§ï¼ˆè¦æ˜¯èƒ½æŒ‰ä¸€å®šé€»è¾‘è®¾ç½®å°±æ›´å¥½äº†ï¼‰
2. èƒ½è®¾ç½® v çš„å…¬æœ‰å±æ€§

js ç”¨äº†ä»¥ä¸‹ä¸œè¥¿æ¥æ“ä½œï¼š

1. ç”¨ä¸€ä¸ªå‡½æ•° f æ¥è®¾ç½®è‡ªæœ‰å±æ€§ï¼Œå‡½æ•°æ‹¥æœ‰é€»è¾‘ï¼Œæ›´è´´åˆ‡
2. ä¸€ä¸ªå¯¹è±¡ pï¼ŒåŒ…å«æ‰€æœ‰ç±» v å®ä¾‹çš„å…¬æœ‰å±æ€§

ä¸ºäº†æ›´åŠ ç´§å¯†ã€è§„èŒƒï¼š

1. å‡½æ•°é‡‡ç”¨å¤§å†™å‘½å Fï¼Œåˆ«åæ„é€ å‡½æ•°
2. å‡½æ•°å¤©ç”Ÿæ‹¥æœ‰ä¸€ä¸ªå±æ€§`prototype`ï¼Œæ¥å­˜å‚¨å¯¹è±¡ p

æ‰€ä»¥ä»»ä½•ä¸€ä¸ªå®ä¾‹ v å°±å¯ä»¥ç”±ä¸€ä¸ªæ„é€ å‡½æ•° F ç”Ÿæˆã€‚

ç”Ÿæˆåçš„ v æ€ä¹ˆä¸æ„é€ å‡½æ•°å…³è”å‘¢ã€‚

æƒ³å½“ç„¶çš„æ˜¯ v çš„ä¸€ä¸ªå±æ€§æŒ‡å‘æ„é€ å‡½æ•° Fï¼Œé—®é¢˜æœ‰ä¸¤ï¼š

1. è¯¥å…³è”å±æ€§åº”è¯¥æœ‰æ‰€éšè—ï¼Œä¸èƒ½ç®—ä½œ v å®é™…çš„ä¸œè¥¿ï¼Œè€Œä¸”è¦èƒ½é¿å…å±æ€§åå†²çªã€‚
2. å‡å¦‚ v ä¸ F å·²ç»å»ºç«‹äº†å…³ç³»ï¼Œé‚£ä¹ˆè¦ä½¿ç”¨å…¬æœ‰å±æ€§ï¼Œéœ€è¦æ‰¾åˆ° Fï¼Œç„¶åè°ƒç”¨ F.prototype.fnï¼Œä¸ç¬¦åˆä½¿ç”¨ä½“éªŒã€‚

js é‡‡ç”¨äº†ä»¥ä¸‹è®¾ç½®ï¼š

1. å˜é‡ v æ‹¥æœ‰ä¸€ä¸ªéšå¼åŸå‹`[[prototype]]`ï¼Œå„ä¸ªæµè§ˆå™¨å®ç°ä¸º`__proto__`å±æ€§æ¥è¿›è¡Œè®¿é—®ã€‚
2. `__proto__`ç›´æ¥æŒ‡å‘å…¬æœ‰å±æ€§ pï¼Œè€Œä¸æ˜¯æ„é€ å‡½æ•° Fï¼Œè€Œå‡ºäºåˆè¦èƒ½ä¸æ„é€ å‡½æ•° F å…³è”ï¼Œæ‰€ä»¥æŠŠ F å­˜åœ¨äº†å…¬æœ‰å±æ€§ p çš„å±æ€§`constructor`ä¸­ã€‚

è‡³æ­¤ï¼Œä¸€åˆ‡å…³è”éƒ½ç†æ‰€å½“ç„¶ã€‚

#### è§£å†³ Function

æ„é€ å‡½æ•° F åˆæ˜¯è°ç”Ÿæˆçš„å‘¢ï¼ŸæŒ‰ç…§æ¨è®ºåˆ°åº•ï¼Œæ˜¯ Function å‡½æ•°ï¼Œé‚£ä¹ˆ Function å‡½æ•°åˆæ˜¯ç”±å“ªä¸ªæ„é€ å‡½æ•°ç”Ÿæˆçš„å‘¢ã€‚

å‡½æ•° Function è‡ªå·±åˆ›é€ äº†è‡ªå·±ï¼Œè¿™æ¡è§„åˆ™å´ä¸é€‚ç”¨äº Object.prototype

- âœ…`Function.__proto__.constructor === Function`
- âœ…`Function.__proto__ === Function.prototype`
- âŒ`Object.prototype.__proto__ === Object.prototype`

#### è§£å†³ Object.prorotype

å…¬æœ‰å±æ€§ pï¼Œä¹Ÿå°±æ˜¯åŸå‹ prototype æ¨è®ºåˆ°åº•ï¼Œæ˜¯ç”± Object æ„é€ å‡½æ•°ç”Ÿæˆçš„ï¼ŒObject åœ¨ä¸Šè¿°ç¬¬ä¸€ä¸ªé—®é¢˜ä¸­äº§ç”Ÿï¼Œå¯æ˜¯ Object.prototype åˆæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ã€‚

null ä¸å€Ÿæ„é€ å‡½æ•°å°±åˆ›é€ äº† Object.prototypeï¼Œå³ï¼š

- âœ…`Object.prototype.__proto__ === null`

é‚£ä¹ˆè‡ªç„¶ Object.prototype çš„æ„é€ å‡½æ•°ä¹Ÿæ²¡æœ‰ã€‚

![http://www.mollypages.org/tutorials/js.mp](~images/js/prototype.jpg)

### new

1. åˆ›å»ºç©ºå¯¹è±¡
2. é“¾æ¥åŸå‹é“¾
3. æ‰§è¡Œæ„é€ å‡½æ•°
4. æ ¹æ®æ­¥éª¤ 3 çš„ç»“æœç±»å‹è¿”å›ä¸åŒçš„å€¼

```javascript
var _new = function () {
  var Constructor = [].shift.call(arguments);
  if (typeof Constructor !== "function") {
    throw new Error("è¯·ä¼ å…¥æ­£ç¡®çš„æ„é€ å‡½æ•°");
  }
  var instance = Object.create(Constructor.prototype);
  var ret = Constructor.apply(instance, arguments);
  return ret instanceof Object ? ret : instance;
};
```

## å¼‚æ­¥ç¼–ç¨‹

### Promise

promise çš„ thenï¼Œå¦‚æœåœ¨æ‰§è¡Œ promise åï¼Œè¯¥ promise ä¸º resolved çŠ¶æ€ï¼Œé‚£ä¹ˆ then ä¼šè¢«é©¬ä¸Šè¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚

#### Promise.resolve()

çµæ´»è¿ç”¨è½¬ Promise å¯¹è±¡çš„æ¥å£ Promise.resolve()ã€‚

å‚æ•°å¤„ç†æƒ…å†µå¦‚ä¸‹ï¼š

- Promise å¯¹è±¡ï¼Œç›´æ¥è¿”å›ã€‚
- thenable å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ then æ–¹æ³•é‡Œå¿…é¡»ä½¿ç”¨ resolve æˆ–è€… rejectï¼Œå¦åˆ™ Promise.resolve(thenable å¯¹è±¡)ä¸€ç›´æ˜¯ pending çŠ¶æ€

```javascript
const obj = {
  then: () => {},
};

Promise.resolve(obj);
// ç­‰ä»·äº
new Promise(obj.then);
```

- å…¶ä»–å€¼ã€‚

```javascript
const obj = {};
Promise.resolve(obj);
// ç­‰ä»·äº
new Promise((resolve) => resolve(obj));
```

- ä¸ä¼ å€¼ã€‚ç­‰ä»·äº Promise(undefined)

#### åˆ©ç”¨`runner`å‡½æ•°è¿›è¡Œå¸¦é€»è¾‘çš„å¼‚æ­¥è¯·æ±‚

```javascript
function runner(_gen) {
  return new Promise((resolve, reject) => {
    var gen = _gen();

    _next();
    function _next(_last_res) {
      var res = gen.next(_last_res);

      if (!res.done) {
        var obj = res.value;

        if (obj.then) {
          obj.then(
            (res) => {
              _next(res);
            },
            (err) => {
              reject(err);
            }
          );
        } else if (typeof obj == "function") {
          if (
            obj.constructor
              .toString()
              .startsWith("function GeneratorFunction()")
          ) {
            runner(obj).then((res) => _next(res), reject);
          } else {
            _next(obj());
          }
        } else {
          _next(obj);
        }
      } else {
        resolve(res.value);
      }
    }
  });
}

runner(function* () {
  let userData = yield $.ajax({ url: "getUserData", dataType: "json" });

  if (userData.type == "VIP") {
    let items = yield $.ajax({ url: "getVIPItems", dataType: "json" });
  } else {
    let items = yield $.ajax({ url: "getItems", dataType: "json" });
  }

  //ç”Ÿæˆã€...
});
```

> ä¸`async/await`åŒºåˆ«
>
> - å†™æ³•ä¸€æ ·ï¼Œè¿˜ä¸éœ€è¦`runner`å‡½æ•°
> - è¿˜å¯ä»¥å†™æˆç®­å¤´å‡½æ•°ã€‚

### Generator å‡½æ•°

- ä¸€ä¸ªçŠ¶æ€æœºï¼Œå†…éƒ¨å°è£…äº†å¾ˆå¤šç§çŠ¶æ€ã€‚
- æ­¤å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡

å¯ç”¨ç»“æ„æ“ä½œç¬¦`...`éå†ã€‚

```javascript
function* initializer(count, mapFunc = (i) => i) {
  for (let i = 0; i < count; i++) {
    const value = mapFunc(i, count);
    if (mapFunc.constructor.name === "GeneratorFunction") {
      yield* value;
    } else {
      yield value;
    }
  }
}

// ç”¨äºç”Ÿæˆ52å¼ æ‰‘å…‹ç‰Œ
const cards = [
  ...initializer(13, function* (i) {
    let p = i + 1;
    if (p === 1) {
      p = "A";
    }
    if (p === 11) {
      p = "J";
    }
    if (p === 12) {
      p = "Q";
    }
    if (p === 13) {
      p = "K";
    }
    yield `â™ ${p}`;
    yield `â™£ï¸${p}`;
    yield `â™¥ï¸${p}`;
    yield `â™¦ï¸${p}`;
  }),
];
```

### async/await

ä½¿ç”¨ try/catch æ•è· await çš„é”™è¯¯ï¼Œå¦‚æœä¸è¿™æ ·ï¼Œé‚£ä¹ˆæŠ¥é”™åé¢çš„ä»£ç é€»è¾‘å°†ä¸ä¼šæ‰§è¡Œã€‚å¦å¤–ï¼Œcatch ä¸­æŠ›å‡ºé”™è¯¯ï¼Œä»£ç ä¹Ÿä¼šåœæ­¢ã€‚

```javascaript
// æ³¨æ„åŒºåˆ†
const a = yield 3; // a: undefined
const b = await 3; // b: 3
```

## `Iterator`

é»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„ Symbol.iterator å±æ€§ä¸Šã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸€ä¸ªæ•°æ®å®ç°äº†è¿™ä¸ªå±æ€§ï¼Œä»–å°±å¯ä»¥ä½¿ç”¨ for...of è¿›è¡Œéå†ã€‚æ­¤å±æ€§å€¼å¿…é¡»ä¸ºä¸€ä¸ª**éå†å™¨å¯¹è±¡**ï¼ˆå«æœ‰ next æ–¹æ³•çš„å¯¹è±¡ï¼‰ã€‚

```javascript
let flag = false;
const obj = {
  [Symbol.iterator]() {
    return {
      next() {
        if (flag) {
          return {
            value: 3,
            done: true,
          };
        } else {
          flag = true;
          return {
            value: 3,
            done: false,
          };
        }
      },
    };
  },
};
for (let k of obj) {
  console.log(k);
}
// 3
```

## æ­£åˆ™è¡¨è¾¾å¼

æ­£åˆ™è¦ä¹ˆåŒ¹é…å­—ç¬¦ï¼Œè¦ä¹ˆåŒ¹é…ä½ç½®ã€‚

### æç¤ºè¦ç‚¹

- å­—ç¬¦é›†`[]`ä¸­çš„ç‰¹æ®Šå­—ç¬¦æ— éœ€è½¬ä¹‰ç¬¦`\`ï¼ˆè½¬ä¹‰ä¹Ÿå¯ä»¥ï¼‰
- `\1` `\2`ä»£è¡¨æ‹¬å·åŒ¹é…ç»“æœï¼Œå®¿ä¸»ç¯å¢ƒä¸ä¸€å®šæ˜¯è¿™ä¸ªï¼Œä¾‹å¦‚ js ç¯å¢ƒä¸­æ˜¯`$1`

### ä½ç½®

`\b` `\B` `^` `$` `(?=p)` éƒ½è¡¨ç¤ºä½ç½®ï¼Œä½ç½®éƒ½ä¸å‚ä¸å®é™…åŒ¹é…ç»“æœã€‚

#### `(?=p)`ï¼š

è¡¨ç¤º p å‰é¢çš„ä½ç½®ã€‚åä¹‰æ˜¯`(?!p)`ã€‚åå‘æ˜¯`(?<=p)`ï¼Œè¡¨ç¤º p åé¢çš„ä½ç½®ã€‚åä¹‰æ˜¯`(?<!p)`ã€‚

p æœ¬èº«å¹¶ä¸æ˜¯åŒ¹é…ç»“æœï¼Œå®ƒåªæ˜¯åŒ¹é…çš„æ¡ä»¶ã€‚ä¾‹å¦‚ä½ è¦åŒ¹é…çš„å­—ç¬¦æ˜¯ xxxã€‚åªèƒ½ä½¿ç”¨å¦‚ä¸‹å‡ ç§ç»„åˆæ–¹å¼ï¼š
`xxx(?=p)` positive lookahead
`xxx(?!p)` negative lookahead
`(?<=p)xxx` positive lookbehind
`(?<!p)xxx` negative lookbehind

### è´ªå©ªæ¨¡å¼

é»˜è®¤åŒ¹é…æ˜¯è´ªå©ªåŒ¹é…ï¼Œå¯ä»¥åœ¨é‡è¯`*`æˆ–è€…`{m,n}`åé¢åŠ ä¸Š`?`ç¬¦å·ï¼Œä½¿å…¶æƒ°æ€§åŒ¹é…ã€‚

### åˆ†ç»„

åŒ¹é…ä¸‹é¢ä¸€ä¸ªå­—ç¬¦

- åœ¨ä»£ç é‡Œæ˜¯å­—ç¬¦ä¸²æ¨¡å¼
- é‡Œé¢æœ‰åŒæ–œæ `//`

é‚£ä¹ˆè§„åˆ™ä¸º

```
/(?<!\\)('|"|`).*?\/\/.*?(?<!\\)\1/mg
```

### è®¡ç®—åŒ¹é…ç»“æœ

- `match`å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œåœ¨æ²¡ g çš„æƒ…å†µä¸‹è·Ÿ exec ç±»ä¼¼ï¼Œä½†æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¸¦ gï¼Œé‚£ä¹ˆå°±åªè¿”å›åŒ¹é…ç»“æœçš„æ•°ç»„ï¼Œ**ä¸å«æ‹¬å·æ•è·å€¼**ã€‚
- `exec`æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œè¿”å›æ•°ç»„ï¼Œåªè¿”å›ç¬¬ä¸€æ¬¡çš„åŒ¹é…ï¼Œæ•°ç»„ä½ç½® 0 ä¸ºåŒ¹é…å­—ç¬¦ï¼Œåç»­ä¸ºæ‹¬å·æ•è·å€¼ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼æ˜¯å« g çš„å…¨å±€åŒ¹é…ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å†æ¬¡æ‰§è¡Œ exec æ–¹æ³•æ¥è·å–æ–°çš„åŒ¹é…ç»“æœï¼Œç›´åˆ°ç»“æœä¸º nullã€‚
- `test`æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œè¿”å› Boolean å€¼ã€‚

## `ajax`

#### åŸç”Ÿå†™æ³•

```javascript
if (window.XMLHttpRequest) {ã€€ // Mozilla, Safari...
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) { // IE
  try {
    xhr = new ActiveXObject('Msxml2.XMLHTTP');
  } catch (e) {
    try {
      xhr = new ActiveXObject('Microsoft.XMLHTTP');
    } catch (e) { }
  }
}
if (xhr) {
  xhr.onreadystatechange = onReadyStateChange;
  xhr.open('get', 'http://localhost:3000/user', true);
  // è®¾ç½® Content-Type ä¸º application/x-www-form-urlencoded
  // ä»¥è¡¨å•çš„å½¢å¼ä¼ é€’æ•°æ®
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.send('username=admin&password=root');
}

// onreadystatechange æ–¹æ³•
function onReadyStateChange() {
  // è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨å››æ¬¡
  console.log(xhr.readyState);
  if (xhr.readyState === 4) {
    // everything is good, the response is received
    if (xhr.status === 200) {
      console.log(JSON.parse(xhr.responseText);
    } else {
      console.log('There was a problem with the request.');
    }
  } else {
    // still not ready
    console.log('still not ready...');
  }
}
```

#### `fetch`

åŸºäº Promise è®¾è®¡ï¼ŒåŸºç¡€ç”¨æ³•å¦‚ä¸‹ã€‚

```javascript
fetch(url, {
  method: 'post',
  body: JSON.stringify({
    a: 1,
    b: 2
  }),
  // body: 'a=1&b=2',
  headers: {
    'Content-Type': 'application/json'
    // 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'
  },
  // æ˜¯å¦å¸¦cookie
  // same-origin: åŒæºå¸¦ include: å§‹ç»ˆå¸¦ omit: ä¸å¸¦
  credentials: 'omit' //é»˜è®¤
})
  .then(
    response => {
      // åœ¨è¿™é‡Œè¿›è¡Œä¸­é—´ä»¶æ“ä½œï¼Œå°è£…
      if (response.ok) {
        return response.json()
      } else {
        // throw new Error('fetch done. but something is wrong!')
        return Promise.reject({
          status: response.status,
          statusText: response.statusText
        })
      }
    },
    error => {
      // è¯·æ±‚æœ¬èº«æ²¡æˆåŠŸï¼Œæ¯”å¦‚urlåœ°å€é”™è¯¯
      console.log('fetch is error', error) })
    }
  )
  .then(data => {
    // å¤„ç†æœ€ç»ˆç»“æœ
  })
  .catch(error => {
    // ä¸­é—´ä»¶æ•è·çš„é”™è¯¯
  })
```

 æœ‰å‡ ä¸ªå‘

- `cookie` ä¼ é€’
- `404`ã€`503` ç­‰é”™è¯¯ä¸è¢«è®¤ä¸ºæ˜¯ç½‘ç»œé”™è¯¯ï¼Œæ˜¯ä¸ä¼šæŠ›é”™çš„ã€‚åœ¨ä¸­é—´ä»¶é‡Œç”¨ `reponse.ok` ä¸ `response.status` æ¥ç¡®å®šå¤„ç†

### è¿ç­‰èµ‹å€¼

ä¸€é“â€é¢è¯•â€œé¢˜

```javascript
var a = { n: 1 };
a.x = a = { n: 2 };
console.log(a.x); // ???
```

- è¿ç­‰èµ‹å€¼ä¼šæå‰ä¿å­˜å¯¹è±¡çš„å¼•ç”¨ï¼Œå¤åˆ¶æ—¶å³è¾¹å–æ–°çš„ï¼Œå·¦è¾¹å–æå‰ä¿å­˜çš„ã€‚
- A=B=C çš„è°ƒç”¨è¿‡ç¨‹å…¶å®æ˜¯ B=Cï¼Œå†æ‰§è¡Œ A=Bï¼Œæ³¨æ„ C å€¼åªè°ƒç”¨ä¸€æ¬¡ï¼ˆå¯ç”¨ getter è¿›è¡Œæµ‹è¯•ï¼‰

æ‰€ä»¥ä¸Šè¿°ç­”æ¡ˆä¸º`undefined`

## Array

### Array.prototype.map

å†…éƒ¨åŸç†ï¼š

- æå‰é¢„çŸ¥å¹¶ç¡®å®šå¾ªç¯é•¿åº¦
- æ‰§è¡Œæ—¶
  - å…ƒç´ ä¸º emptyï¼Œä¸è¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œå¹¶åœ¨è¿”å›å€¼ä¸­è®¾ä¸º empty
  - å…ƒç´ ä¸ä¸º emptyï¼Œè·å–æ­¤åˆ»åŸæ•°ç»„çš„å…ƒç´ å€¼ï¼Œæ‰§è¡Œæ–¹æ³•è°ƒç”¨

> ä½¿ç”¨ map æ–¹æ³•å¤„ç†æ•°ç»„æ—¶ï¼Œæ•°ç»„å…ƒç´ çš„èŒƒå›´æ˜¯åœ¨ callback æ–¹æ³•ç¬¬ä¸€æ¬¡è°ƒç”¨ä¹‹å‰å°±å·²ç»ç¡®å®šäº†ã€‚åœ¨ map æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼šåŸæ•°ç»„ä¸­æ–°å¢åŠ çš„å…ƒç´ å°†ä¸ä¼šè¢« callback è®¿é—®åˆ°ï¼›è‹¥å·²ç»å­˜åœ¨çš„å…ƒç´ è¢«æ”¹å˜æˆ–åˆ é™¤äº†ï¼Œåˆ™å®ƒä»¬çš„ä¼ é€’åˆ° callback çš„å€¼æ˜¯ map æ–¹æ³•éå†åˆ°å®ƒä»¬çš„é‚£ä¸€æ—¶åˆ»çš„å€¼ï¼›è€Œè¢«åˆ é™¤çš„å…ƒç´ å°†ä¸ä¼šè¢«è®¿é—®åˆ°ã€‚ â€”â€” MDN https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map

> è¾¹å¾ªç¯è¾¹æ›´æ”¹åŸæ•°ç»„æ—¶ï¼Œæœ‰ä¸¤ä¸ªç‰¹ç‚¹ã€‚ä¸€æ˜¯å¾ªç¯é•¿åº¦åªå‡ä¸å¢ï¼ŒäºŒæ˜¯å¾ªç¯å€¼ä¸ºæ›´æ”¹ååŸæ•°ç»„æŒ‰ index å–å€¼ã€‚

### Array.prototype.reduce

ä¼ å…¥å‡½æ•°çš„ aï¼Œb å€¼å¹¶ä¸æ˜¯æ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œå‡†ç¡®çš„è®²ï¼Œåˆ†åˆ«ä¸ºç´¯åŠ å™¨ä¸å½“å‰é¡¹ï¼Œæœ‰ 2 ç§æƒ…å†µï¼š

- è®¾å®šäº†åˆå§‹å€¼ï¼Œç¬¬ 1 æ¬¡å¾ªç¯ï¼Œç´¯åŠ å™¨å€¼ä¸ºåˆå§‹å€¼
- æœªè®¾å®šåˆå§‹å€¼ï¼Œç¬¬ 1 æ¬¡å¾ªç¯ï¼Œç´¯åŠ å™¨å€¼ä¸ºç¬¬ 1 é¡¹ï¼Œä¸”ä»æ•°ç»„ç¬¬ 2 é¡¹å¼€å§‹å¾ªç¯

ç»¼ä¸Šï¼Œåº”é¿å…ä»¥ä¸‹é”™è¯¯ï¼š

```javascript
// âŒ æŠ¥é”™
const arr = []; //ä¸€å®šè¦ç¡®å®šæ•°ç»„ä¸ä¸ºç©º
arr.reduce((a, b) => a + b);

// âŒ ç»“æœä¸ºNaN
const arr = [{ price: 1 }, { price: 2 }];
arr.reduce((a, b) => a.price + b.price, 0);
```

### empty

ä½¿ç”¨`delete arr[i]`ï¼ŒåŸæ•°ç»„çš„ä¸‹æ ‡å¹¶ä¸ä¼šæ”¹å˜ï¼Œè€Œæ˜¯åœ¨åŸæ¥çš„ä¸‹è¾¹å‡ºï¼ŒæŠŠå€¼è®¾ä¸º emptyï¼Œæ­¤å€¼æœ‰ä¸€å®šçš„ç‰¹æ®Šæ€§ã€‚

```javascript
const arr = [1, 2, 3, 4, 5];
arr[1] = undefined;
delete arr[3];
console.log("changed : ", arr);

// for (ä¸è·³è¿‡ä»»æ„)
for (let i = 0; i < arr.length; i++) {
  console.log(`for ${arr[i]}`);
}

// mapï¼ˆè·³è¿‡emptyï¼Œè¿”å›ç»“æœåŒ…å«emptyï¼‰
const mapedArr = arr.map((v) => {
  console.log(`map ${v}`);
  return "hello";
});
console.log(`mapedArr ${mapedArr}`, mapedArr);
// filterï¼ˆè·³è¿‡emptyï¼Œè¿”å›ç»“æœä¸åŒ…å«emptyï¼‰
arr.forEach((v) => console.log(`forEach ${v}`));
const filteredArr = arr.filter((v) => {
  console.log(`filter ${v}`);
  return true;
});
console.log(`filteredArr ${filteredArr}`, filteredArr);
```

### async/await

æ³¨æ„ for å¾ªç¯ï¼ˆå¾ªç¯ä¹‹é—´ä¼šç­‰å¾…ï¼‰ä¸ forEachï¼ˆä¸ä¼šç­‰å¾…ï¼‰è°ƒç”¨çš„ä¸åŒã€‚

### ç¨€ç–ä¸å¯†é›†æ•°ç»„

ç¨€ç–æ•°ç»„å³éè¿ç»­æ€§æ•°ç»„ï¼Œé‡Œé¢æœ‰ç©ºå…ƒç´ ï¼Œè¿™åœ¨ä½¿ç”¨æ•°ç»„æ–¹æ³•ï¼ˆmap,forEach ç­‰ï¼‰æ—¶ä¸ä¼šéå†è¯¥å…ƒç´ ã€‚

å¿«é€Ÿåˆ›å»ºå¯†é›†æ•°ç»„ï¼š

```javascript
//
const arr = Array.apply(null, Array(3));
// [undefined, undefined, undefined]

// æ‰©å±•åº”ç”¨
const arr = Array.apply(null, Array(5));

arr.map(Function.prototype.call.bind(Number));
arr.map(Function.prototype.call, Number);
// ç­‰åŒäºä¸‹é¢
arr.map((v, i, array) => {
  return Number.call(v, i, array);
});
// [1, 2, 3, 4, 5]
// ï¼Ÿï¼Ÿï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·ä¸è¡Œï¼Œarr.map(Number.call)
```

## æ•°æ®è½¬æ¢ä¸ºè§„åˆ™

### ToPrimitive

è½¬æ¢é€»è¾‘ï¼š
å¦‚æœå·²ç»æ˜¯åŸå§‹ç±»å‹äº†ï¼Œé‚£å°±ä¸éœ€è¦è½¬æ¢äº†
å¦‚æœéœ€è¦è½¬å­—ç¬¦ä¸²ç±»å‹å°±è°ƒç”¨ x.toString()ï¼Œè½¬æ¢ä¸ºåŸºç¡€ç±»å‹çš„è¯å°±è¿”å›è½¬æ¢çš„å€¼ã€‚ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„è¯å°±å…ˆè°ƒç”¨ valueOfï¼Œç»“æœä¸æ˜¯åŸºç¡€ç±»å‹çš„è¯å†è°ƒç”¨ toString
è°ƒç”¨ x.valueOf()ï¼Œå¦‚æœè½¬æ¢ä¸ºåŸºç¡€ç±»å‹ï¼Œå°±è¿”å›è½¬æ¢çš„å€¼
å¦‚æœéƒ½æ²¡æœ‰è¿”å›åŸå§‹ç±»å‹ï¼Œå°±ä¼šæŠ¥é”™

#### string

è°ƒç”¨ toString æ–¹æ³•ï¼š

- åŸå§‹å€¼ï¼Œå¼ºè½¬ string åçš„åŸå§‹å€¼
- éåŸå§‹å€¼ï¼Œè°ƒç”¨ valueOf æ–¹æ³•
  - åŸå§‹å€¼ï¼Œå¼ºè½¬ string åçš„åŸå§‹å€¼
  - éåŸå§‹å€¼ï¼ŒæŠ›å‡ºå¼‚å¸¸`TypeError: Cannot convert object to primitive value`

> **åœ¨ + è¿ç®—ç¬¦æ—¶ï¼Œè¡¨ç°ä¸ºå…ˆä½¿ç”¨ valueOf()**ã€‚Date å¯¹è±¡ç›´æ¥è°ƒç”¨ toString å®Œæˆè½¬æ¢ï¼Œå…¶ä»–å¯¹è±¡é€šè¿‡ valueOf è½¬åŒ–ï¼Œå¦‚æœè½¬æ¢ä¸æˆåŠŸåˆ™è°ƒç”¨ toStringã€‚

#### number

è°ƒç”¨ valueOf æ–¹æ³•ï¼š

- åŸå§‹å€¼ï¼Œreturn å¼ºè½¬ number åçš„åŸå§‹å€¼
- éåŸå§‹å€¼ï¼Œè°ƒç”¨ toString æ–¹æ³• - åŸå§‹å€¼ï¼Œreturn å¼ºè½¬ number åçš„åŸå§‹å€¼ - éåŸå§‹å€¼ï¼ŒæŠ›å‡ºå¼‚å¸¸`TypeError: Cannot convert object to primitive value`
  > å¼ºè½¬ number è§„åˆ™ï¼Œnull -> 0ï¼Œundefined -> NaNï¼Œtrue -> 1ï¼Œfalse -> 0ï¼Œå¤±è´¥ -> NaN

## é€’å½’

çº¯ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€æ²¡æœ‰å¾ªç¯æ“ä½œå‘½ä»¤ï¼Œæ‰€æœ‰çš„å¾ªç¯éƒ½ç”¨é€’å½’å®ç°ã€‚

é€’å½’å°±æ˜¯å‡½æ•°è‡ªå·±è°ƒç”¨è‡ªå·±ã€‚

### å°¾è°ƒç”¨

å‡½æ•°æœ€åä¸€æ­¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œåªè°ƒç”¨å‡½æ•°ï¼Œä¸åšå…¶å®ƒè¿ç®—ã€‚

### å°¾é€’å½’

å‡½æ•°æœ€åä¸€æ­¥è°ƒç”¨è‡ªèº«ã€‚

ä¾‹å¦‚ï¼šä¸€ä¸ªé˜¶ä¹˜å‡½æ•°ï¼Œn å¤Ÿå¤§æ—¶å‘ç”Ÿæ ˆæº¢å‡ºã€‚

```javascript
function factorial(n) {
  if (n === 1) return 1;
  return n * factorial(n - 1);
}
```

æ”¹å†™æˆå°¾é€’å½’ï¼Œç”±äºæ¯æ¬¡æ‰§è¡Œå®Œåä¸éœ€è¦ä¿æŒå½“å‰ä½œç”¨åŸŸçš„å˜é‡ï¼Œæ‰€ä»¥å¯é”€æ¯ï¼Œæ°¸è¿œåªæœ‰ä¸€å±‚ï¼ˆV8 å¼•æ“æœªå®ç°ï¼‰ã€‚

```javascript
function factorial(n, total) {
  if (n === 1) return total;
  return factorial(n - 1, n * total);
}
```

å¯¹äºä¸æ”¯æŒè‡ªåŠ¨ä¼˜åŒ–çš„ï¼Œæ”¹å†™ä¸ºè¿­ä»£æ¨¡å¼ã€‚

```javascript
const factorial = (v) => {
  let initialValue = v;
  let result = 1;
  while (initialValue > 0) {
    result = initialValue * result;
    initialValue--;
  }
  return result;
};
```

## å†…å­˜

å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸï¼š

1. åˆ†é…å†…å­˜
2. ä½¿ç”¨å†…å­˜ï¼ˆè¯»å†™ï¼‰
3. é‡Šæ”¾å†…å­˜

åœ¨ä½çº§è¯­è¨€ä¸­ï¼ˆcï¼‰ï¼Œ1/3 æ­¥éª¤æ˜¯éœ€è¦æ‰‹åŠ¨æ“ä½œçš„ã€‚è€Œåœ¨ js ä¸­ï¼Œè¿™å˜æˆäº†è‡ªåŠ¨ã€‚

### æ ˆï¼ˆstackï¼‰ã€å †ï¼ˆheapï¼‰

å †æ ˆæ˜¯æ“ä½œç³»ç»Ÿç»™åº”ç”¨ç¨‹åºåˆ†é…çš„ä¸¤ç§ä¸åŒçš„å†…å­˜ç©ºé—´æ–¹æ¡ˆã€‚stack æ˜¯ os åˆ†é…çš„**å›ºå®š**çš„ä¸€ç‰‡è¿ç»­å†…å­˜ï¼Œçº¿ç¨‹åœ¨è¿™ä¸ªèŒƒå›´å†…é¡ºåºè¯»å†™ã€‚heap ä¹Ÿæ˜¯ os åˆ†é…çš„ä¸€ç‰‡å†…å­˜ï¼Œä½†æ˜¯æ•°æ®å´åˆ†å¸ƒçš„å­˜å‚¨åœ¨å„å¤„ã€‚

è¿›è¡Œè¿™æ ·çš„æ–¹æ¡ˆï¼Œæ˜¯å› ä¸ºç¨‹åºé€šå¸¸ä¼šæœ‰ä¸€äº›å­˜åœ¨æ—¶é—´æçŸ­ï¼Œæå°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ­¤ç±»æ•°æ®å¯ä»¥ä¿å­˜åœ¨ stack ä¸­ï¼Œåœ¨ js é‡Œä»£è¡¨æ‰§è¡Œä¸Šä¸‹æ–‡å˜é‡ã€ä¸€äº›åŸºç¡€æ•°æ®ç±»å‹å€¼ã€‚è€Œä¸€äº›å¤§å°ä¸å›ºå®šï¼Œå¤æ‚çš„æ•°æ®ä¼šä¿å­˜åœ¨ heap ä¸­ï¼Œåœ¨ js é‡Œä»£è¡¨çš„æ˜¯å¼•ç”¨ç±»å‹æ•°æ®ã€‚

stack ä¼šå› ä¸ºåµŒå¥—è°ƒç”¨å¤ªå¤šæˆ–è€…æ•°æ®é‡è¿‡å¤§é€ æˆ stackoverflowï¼ˆå †æ ˆæº¢å‡ºï¼‰ï¼Œheap ä¼šäº§ç”Ÿæ›´å¤šçš„å†…å­˜ç¢ç‰‡ã€‚

é€šå¸¸ä¸€ä¸ªçº¿ç¨‹ä¼šæœ‰è‡ªå·±ç‹¬ç«‹çš„ stackï¼Œè€Œ heap å¯èƒ½ä¼šè¿›è¡Œå…±äº«ã€‚

ç”±äº stack é€šå¸¸æ˜¯å³ç”¨å³é”€æ¯ï¼Œå› æ­¤ os é¡ºä¾¿è¿›è¡Œäº†å†…å­˜ç®¡ç†ï¼Œè€Œ heap è¾ƒå¤æ‚ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†ã€‚é‚£ä¹ˆåƒåœ¾å›æ”¶ä¸»è¦å°±æ˜¯å›æ”¶å †å†…å­˜çš„æ•°æ®ã€‚

> Chrome Devtool é‡Œçš„ Memory é€‰é¡¹å¡å°±ç”¨äºå¯¹å †å†…å­˜çš„ç›‘æ§ã€‚

### åƒåœ¾å›æ”¶ GCï¼ˆGarbage Collectionï¼‰

- å¼•ç”¨è®¡æ•°ï¼ˆreference countingï¼‰ã€‚ç¼ºç‚¹ï¼šæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨ã€‚
- æ ‡è®°-æ¸…é™¤ï¼ˆmark and sweep algorithmï¼‰ã€‚ä»æ ¹å¯¹è±¡å‡ºå‘ï¼Œä¾æ¬¡æœç´¢å…¶å­èŠ‚ç‚¹ï¼Œå†é€’å½’ï¼Œæ‰€æœ‰èƒ½è¾¾åˆ°çš„èŠ‚ç‚¹å³ä¸ºæ´»åŠ¨èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹å³å¯æ¸…é™¤ã€‚

å †ä¸­åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ä¸¤ä¸ªåŒºåŸŸã€‚

#### æ–°ç”Ÿä»£

å­˜æ”¾ä¸´æ—¶å¯¹è±¡ï¼Œç”±å‰¯åƒåœ¾å›æ”¶å™¨ Scavenge ç®¡ç†ã€‚æ ‡è®°åŠ å¤åˆ¶çš„æ–¹å¼æ•´ç†å†…å­˜ã€‚

#### è€ç”Ÿä»£

å­˜æ”¾æŒä¹…å¯¹è±¡ï¼Œç”±ä¸»åƒåœ¾å›æ”¶å™¨ç®¡ç†ã€‚åœ¨æ–°ç”Ÿä»£å¤šæ¬¡å›æ”¶è¿‡åä¾ç„¶ä¿ç•™çš„å¯¹è±¡ä¼šè½¬ç§»åˆ°è€ç”Ÿä»£åŒºåŸŸã€‚

### å¸¸è§å†…å­˜æ³„æ¼

- å…¨å±€å˜é‡ã€‚ä¸å£°æ˜å˜é‡æˆ–è€…å…¨å±€ä½œç”¨åŸŸå‡½æ•°ä¸­è°ƒç”¨ thisï¼Œä¸å°å¿ƒæŠŠå˜é‡æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Šï¼Œæ­¤å˜é‡ä¸€ç›´è¢«å…¨å±€å¯¹è±¡å¼•ç”¨ï¼Œåªæœ‰å…³é—­çª—å£æˆ–è€…é‡æ–°åˆ·æ–°é¡µé¢æ‰è¢«é‡Šæ”¾ã€‚
- console.logã€‚ä¼ å…¥çš„å¯¹è±¡ä¼šè¢«ä¸€ç›´å¼•ç”¨ï¼Œä¸ä¼šè¢« GC å›æ”¶ã€‚
- é—­åŒ…ã€‚é¦–å…ˆé—­åŒ…æœ¬èº«å¸¦ä½œç”¨åŸŸï¼Œæ‰€ä»¥å ç”¨å†…å­˜ä¼šæ¯”ä¸€èˆ¬çš„å¤šã€‚ç„¶ååœ¨ä½¿ç”¨æ—¶ï¼Œå¾ˆå¤šä¸æ˜æ˜¾çš„å˜é‡ä¼šè¢«ç¼“å­˜ï¼Œä¾‹å¦‚:

```javascript
function f() {
  var str = Array(10000).join("#");
  var foo = {
    name: "foo",
  };
  const unused = () => {
    var message = "it is only a test message";
    str = "unused: " + str;
  };
  function getData() {
    return "data";
  }
  return getData;
}
var list = [];
document.querySelector("#btn").addEventListener(
  "click",
  function () {
    list.push(f());
  },
  false
);
// strå˜é‡è™½ç„¶æ²¡ä½¿ç”¨ï¼Œä½†ä¸€ç›´è¢«ç¼“å­˜ã€‚
```

è§£é‡Šå¦‚ä¸‹ï¼šåœ¨ç›¸åŒä½œç”¨åŸŸå†…åˆ›å»ºçš„å¤šä¸ªå†…éƒ¨å‡½æ•°å¯¹è±¡æ˜¯å…±äº«åŒä¸€ä¸ªå˜é‡å¯¹è±¡ AOã€‚å¦‚æœåˆ›å»ºçš„å†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸ç®¡å†…éƒ¨å‡½æ•°æ˜¯å¦å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œåœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œï¼Œå¯¹åº”å˜é‡å¯¹è±¡ä¾¿ä¼šè¢«é”€æ¯ã€‚åä¹‹ï¼Œå¦‚æœå†…éƒ¨å‡½æ•°ä¸­å­˜åœ¨æœ‰å¯¹å¤–éƒ¨å‡½æ•°å˜é‡æˆ–å‡½æ•°çš„è®¿é—®ï¼ˆå¯ä»¥ä¸æ˜¯è¢«å¼•ç”¨çš„å†…éƒ¨å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å­˜åœ¨æŸä¸ªæˆ–å¤šä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šå½¢æˆé—­åŒ…ï¼Œå¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡å°±ä¼šå­˜åœ¨äºé—­åŒ…å‡½æ•°çš„ä½œç”¨åŸŸé“¾ä¸­ã€‚è¿™æ ·ç¡®ä¿äº†é—­åŒ…å‡½æ•°æœ‰æƒè®¿é—®å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚

ä¸ªäººç†è§£ï¼šå†…éƒ¨å‡½æ•°æ²¡æœ‰è¢«å¼•ç”¨ï¼Œé‚£ä¹ˆæ‰€æœ‰å˜é‡æ‰§è¡Œå®Œåå°±é”€æ¯ã€‚å¦‚æœæœ‰ä¸€ä¸ªå†…éƒ¨å‡½æ•°è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨ï¼Œé‚£ä¹ˆå¤§å®¶ï¼ˆæ‰€æœ‰å†…éƒ¨å‡½æ•°ï¼‰å¼•ç”¨çš„ä¸œè¥¿éƒ½å¾—å­˜åœ¨é—­åŒ…é‡Œé¢ï¼Œå°±ç®—ä½ æ²¡æœ‰è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨ä¹Ÿå¾—å­˜ä¸‹æ¥ã€‚

å¦ä¸€ä¸ªé—­åŒ…æ³„éœ²ä¾‹å­ï¼š

```javascript
var theThing = null;
var replaceThing = function () {
  var originalThing = theThing;
  var unused = function () {
    if (originalThing) console.log("hi");
  };
  theThing = {
    longStr: new Array(1000000).join("*"),
    someMethod: function () {
      console.log(someMessage);
    },
  };
};
setInterval(replaceThing, 1000);
```

- DOMã€‚dom èµ‹å€¼ç»™å˜é‡ï¼Œdom é”€æ¯åï¼Œå˜é‡ä¾ç„¶ä¿æŒå¼•ç”¨ï¼Œé€ æˆ dom æ²¡æœ‰è¢«çœŸæ­£é”€æ¯ã€‚
- timersã€‚ä¸€èˆ¬æ˜¯ setInterval ç”¨å®Œæ²¡æœ‰è¢«åŠæ—¶ clear ä»¥åŠ setTimeout åµŒå¥—æ²¡æœ‰è¢«æ­£ç¡®ç»ˆæ­¢ã€‚å®šæ—¶å™¨è¿è¡Œä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜ï¼Œå¦å¤–é‡Œé¢å¼•ç”¨çš„å˜é‡ä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚
- EventListenerã€‚ä¸€èˆ¬æ˜¯æŸä¸ªé‡å¤äº‹ä»¶ä¸­ç»‘å®šå…¶ä»– dom äº‹ä»¶ï¼Œå½“äº‹ä»¶é‡å¤æ‰§è¡Œæ—¶ï¼Œé€ æˆäº†é‡å¤ç»‘å®šï¼Œå¯¼è‡´å¼‚å¸¸ã€‚
  > dom.addEventListener('click', fn, false)è¿™ç§æ–¹å¼å¤šæ¬¡æ‰§è¡Œç»‘å®šä¸ä¼šå¢åŠ æ–°äº‹ä»¶ã€‚

## ä¸¥æ ¼æ¨¡å¼

åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹ç‰¹ç‚¹ï¼š

- å…¨å±€å¯¹è±¡ä¸º undefinedã€‚è¿™æ ·å°±ä¸ä¼šå› ä¸ºæœªå£°æ˜å˜é‡è€ŒæŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Šï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼ï¼Œå› ä¸ºä¸€æ—¦æŒ‚è½½äº†ï¼Œé‚£ä¹ˆåªæœ‰åˆ·æ–°é¡µé¢æˆ–è€…å…³é—­ tab æ‰ä¼šè¢«é‡Šæ”¾ã€‚
- arguments ä¸å¯ç”¨ã€‚æ®é˜®ä¸€å³°æ–‡ç« è§£é‡Šï¼Œè¿™æ ·å°±å¯ä»¥ä¼˜åŒ–å°¾é€’å½’ï¼Œå› ä¸ºéä¸¥æ ¼æ¨¡å¼æ‹¥æœ‰ arguments.calleeï¼Œéœ€æŒ‡å‘æœ¬èº«ï¼Œé€ æˆäº†ä½œç”¨åŸŸæ ˆä¸èƒ½è¢«ä¼˜åŒ–ã€‚ï¼ˆæµ‹è¯•æœªé€šè¿‡ï¼‰

## JSON.stringify

JSON.stringify(val, replacer, space)ï¼Œåé¢ 2 ä¸ªå‚æ•°éƒ½åªå¯¹å¯¹è±¡æœ‰æ•ˆã€‚

### replacer

è¾“å‡ºç­–ç•¥ã€‚

- Arrayã€‚åªè½¬æ¢æ•°ç»„å†…çš„ key å€¼ã€‚
- Functionã€‚ä¼ ç»™ä½  key å’Œ valueï¼Œç„¶åè‡ªå·±åšé€»è¾‘æ“ä½œï¼Œè¿”å›æƒ³è¦çš„ valueï¼Œå¦‚æœè¿”å›ä¸º undefinedï¼Œåˆ™ç›¸å½“äºæ’é™¤æ‰è¿™ä¸ª key çš„è¾“å‡ºã€‚
  > æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡çš„ä¼ å…¥æ­¤å‡½æ•°çš„ key å’Œ value åˆ†åˆ«ä¸ºç©ºå­—ç¬¦`''`å’Œå¯¹è±¡æœ¬èº«`obj`ã€‚åé¢æ‰å¼€å§‹æ˜¯æ¯ä¸ª keyã€‚

### space

åªé’ˆå¯¹å¯¹è±¡æœ‰ä½œç”¨ï¼Œç”¨äºç¾åŒ–å¯¹è±¡çš„è¾“å‡ºã€‚æ— è®ºæ˜¯ç©ºæ ¼è¿˜æ˜¯å­—ç¬¦ï¼Œä¸ªæ•°ä¸Šé™éƒ½æ˜¯ 10ã€‚

- Numberã€‚0 å°±æ˜¯é»˜è®¤ï¼Œæ¯” 0 å°æ— æ•ˆã€‚æ¯ä¸€è¡Œå‰é¢åŠ ç›¸åº”æ•°ç›®çš„ç©ºæ ¼ã€‚
- Stringã€‚æ¯ä¸€è¡Œå‰é¢åŠ ç›¸åº”çš„å­—ç¬¦ã€‚

## æ¨¡å—åŒ–

### AMD

ä»£è¡¨ require.jsã€‚éµå¾ª AMDï¼ˆasynchronous module definitionï¼‰è§„èŒƒã€‚æ³¨é‡ä¾èµ–æå‰ç¡®å®šã€‚è¿‡ç¨‹ä¸ºä¾èµ–æå‰ä¸‹è½½ -> ç„¶åä¹±åºæ‰§è¡Œ -> ç­‰å¾…æ‰€æœ‰æ¨¡å—æ‰§è¡Œå®Œæ¯• -> æ‰§è¡Œå›è°ƒå‡½æ•° -> è¾“å‡ºå€¼çš„ä¸€ä»½å¼•ç”¨ã€‚

### CommonJSã€CJS

ä»£è¡¨ nodeã€‚nodejs çš„è‡ªæœ‰æ¨¡å—ç³»ç»Ÿã€‚ä¸€ä¸ªæ–‡ä»¶å³ä¸€ä¸ªæ¨¡å—å³ä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼Œä½¿ç”¨`module.exports = å€¼`æˆ–è€…`exports = å€¼`å¯¼å‡ºã€‚æ‰“åŒ…åï¼Œè¾“å‡ºåˆ° module ä¸­çš„ exports å¯¹è±¡é‡Œ

node ä¸­çš„æ¨¡å—ç¼“å­˜å¯¹è±¡ï¼š

```javascript
{
  'æ¨¡å—çš„ç»å¯¹è·¯å¾„': Module {
    id: '.',
    path: '',
    exports: {},
    parent: null,
    filename: '',
    loaded: false,
    children: [ [Module], [Module] ],
    paths: 'æŸ¥æ‰¾æœç´¢è·¯å¾„'
  },
  }
}
```

#### CMD

ä»£è¡¨ sea.jsã€‚ä¹‹æ‰€ä»¥æ”¾è¿™é‡Œï¼Œæ˜¯ä»¥ä¸ºæ·˜å®å‡ºå“ï¼Œç±»ä¼¼äºé€ è½®å­ï¼Œç±»ä¼¼äº cjsã€‚æ³¨é‡æŒ‰éœ€åŠ è½½ä¾èµ–ã€‚ä¾èµ–æå‰ä¸‹è½½ï¼Œç„¶åè¿è¡Œåˆ°ä½¿ç”¨ require å…³é”®è¯çš„åœ°æ–¹å†æ‰§è¡Œï¼Œè¾“å‡ºå€¼çš„ä¸€ä»½å¼•ç”¨

### EsModuleã€esm

æµè§ˆå™¨ç«¯çš„æ¨¡å—è§„èŒƒã€‚ä½¿ç”¨`export default å€¼`æˆ–è€…`export å®šä¹‰å¼`å¯¼å‡ºï¼Œåè€…ä½¿ç”¨å®šä¹‰å¼æ˜¯å› ä¸ºæ‰“åŒ…å·¥å…·éœ€è¦æŠŠå˜é‡å‘½æŒ‚åœ¨åˆ° module.exports çš„ getter ä¸Šï¼ˆè¿™æ ·èƒ½è·å–åˆ°å®æ—¶çš„å€¼ï¼‰ï¼Œè€ŒæŠŠå‰è€…æ”¾åˆ° module.exports.default é‡Œã€‚

JavaScript è§„èŒƒå£°æ˜ä»»ä½•æ²¡æœ‰ export æˆ–è€…é¡¶å±‚ await çš„ JavaScript æ–‡ä»¶éƒ½åº”è¯¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œè€Œéä¸€ä¸ªæ¨¡å—ã€‚

### UMD

é€šç”¨æ¨¡å—å®šä¹‰ã€‚å…¶å®å°±æ˜¯æ£€æŸ¥äº†å„ä¸ªæ¨¡å—æ”¯æŒæƒ…å†µï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§æ¥å¯¼å‡ºï¼ŒAMD -> CJS -> æµè§ˆå™¨å…¨å±€å˜é‡ï¼Œå› æ­¤åœ¨å¤šä¸ªåœ°æ–¹å¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œå› æ­¤â€œé€šç”¨â€ã€‚

### åŒºåˆ«

commonjs æ˜¯è¿è¡Œæ—¶å†åŠ è½½ï¼Œè€Œ esModule åœ¨åˆæœŸå°±å·²ç»åˆ†æå‡ºä¾èµ–å…³ç³»ï¼ˆå› æ­¤å¯ä»¥åš tree-shakingï¼‰ï¼Œé¢„ç•™å¥½äº†è¦ export çš„å¯¹è±¡çš„å†…å­˜ï¼Œåœ¨å…·ä½“æ‰§è¡Œæ—¶å†è¿›è¡Œå¡«å€¼ã€‚ä½†æ˜¯æ‰“åŒ…å·¥å…·æ˜¯æŠŠ esModule æ‰“åŒ…æˆ commonjs çš„æ¨¡å—ã€‚

### pkg çš„ moduleã€main å­—æ®µ

é€šå¸¸ä¸€ä¸ªåŒ…æœ€ç¨³çš„æ˜¯æä¾›ä¸€ä¸ªç”¨ es5 ä»£ç ç¼–å†™çš„ commonjs è§„èŒƒæ–‡ä»¶ï¼Œæ”¾åœ¨ main å­—æ®µï¼Œä½†æ˜¯ esModule è§„èŒƒæœ‰ä¸ªå¥½å¤„å¯ä»¥åš tree-shakingï¼Œå› æ­¤å¢åŠ äº†ä¸€ä¸ª module å­—æ®µæ¥ä½¿ç”¨ã€‚

### æµè§ˆå™¨æ”¯æŒæƒ…å†µ

éƒ¨åˆ†æµè§ˆå™¨å·²åŸç”Ÿæ”¯æŒ moduleï¼Œéœ€è¦è®¾ç½®`type="module"`ã€‚è§„èŒƒä½¿ç”¨`.mjs`æ¥ä»£è¡¨æ¨¡å—æ–‡ä»¶ï¼Œä¸æ™®é€š js æ–‡ä»¶ä»¥åŒºåˆ†ï¼Œä¸è¿‡`.js`å…¼å®¹æ€§æ›´å¥½ã€‚

## æ–‡ä»¶

### Blob ã€ File ã€ Data URL ã€ ArrayBuffer

- Data URLï¼Œå³ä»¥`data:`åè®®å¼€å¤´çš„ URLï¼Œæ•…åæ€è®®ï¼Œå°±æ˜¯åœ°å€æœ¬èº«ä»£è¡¨äº†å†…å®¹ã€‚ç›®å‰é‡è§çš„æœ‰ï¼š

  - base64 ç¼–ç å†…å®¹åçš„çš„å°æ–‡ä»¶ï¼Œå…¶åœ°å€ä¸ºï¼š`data:${MIMEç±»å‹ï¼Œä¾‹å¦‚: text/html,image/jpeg,text/plainç­‰};base64,${ç¼–ç åå†…å®¹}`
  - æ ‡ç­¾å½¢å¼çš„å†…å®¹ï¼Œæ¯”å¦‚ä¸€å¼  svg å›¾ç‰‡ã€‚å…¶åœ°å€ä¸ºï¼š`data:image/svg+xml,${è½¬ä¹‰åçš„svgæ ‡ç­¾}`

- Blobï¼Œè¡¨ç¤ºä¸€ä¸ªåªè¯»åŸå§‹çš„æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ã€‚
- Fileï¼Œç»§æ‰¿è‡ª Blobï¼Œå¹¶æä¾›äº†ä¸€äº›é¢å¤–çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ï¼šnameã€lastModified ç­‰ã€‚
- ArrayBufferï¼ŒArrayBuffer å¯¹è±¡ç”¨æ¥è¡¨ç¤ºé€šç”¨çš„ã€å›ºå®šé•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ new ArrayBuffer(length)æ¥è·å¾—ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå®ƒä¸èƒ½ç›´æ¥è¯»å†™ï¼Œä½†å¯æ ¹æ®éœ€è¦å°†å…¶ä¼ é€’åˆ° TypedArray è§†å›¾æˆ– DataView å¯¹è±¡æ¥è§£é‡ŠåŸå§‹ç¼“å†²åŒºã€‚å®é™…ä¸Šè§†å›¾åªæ˜¯ç»™ä½ æä¾›äº†ä¸€ä¸ªæŸç§ç±»å‹çš„è¯»å†™æ¥å£ï¼Œè®©ä½ å¯ä»¥æ“ä½œ ArrayBuffer é‡Œçš„æ•°æ®ã€‚TypedArray éœ€æŒ‡å®šä¸€ä¸ªæ•°ç»„ç±»å‹æ¥ä¿è¯æ•°ç»„æˆå‘˜éƒ½æ˜¯åŒä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œè€Œ DataView æ•°ç»„æˆå‘˜å¯ä»¥æ˜¯ä¸åŒçš„æ•°æ®ç±»å‹ã€‚
- TypedArrayï¼Œç±»å‹åŒ–æ•°ç»„æ˜¯è‹¥å¹²ä¸ªç±»æ•°ç»„è§†å›¾çš„ç»Ÿç§°ï¼Œä¸€ä¸ªç±»æ•°ç»„è§†å›¾å¯¹è±¡æè¿°äº†ä¸€ä¸ªåº•å±‚çš„äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºï¼ˆbinay data bufferï¼‰ã€‚
  - Int8Arrayï¼š8 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚ã€‚
  - Uint8Arrayï¼š8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚ã€‚
  - Uint8ClampedArrayï¼š8 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 1 ä¸ªå­—èŠ‚ï¼Œæº¢å‡ºå¤„ç†ä¸åŒã€‚
  - Int16Arrayï¼š16 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 2 ä¸ªå­—èŠ‚ã€‚
  - Uint16Arrayï¼š16 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 2 ä¸ªå­—èŠ‚ã€‚
  - Int32Arrayï¼š32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚
  - Uint32Arrayï¼š32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚
  - Float32Arrayï¼š32 ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦ 4 ä¸ªå­—èŠ‚ã€‚
  - Float64Arrayï¼š64 ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦ 8 ä¸ªå­—èŠ‚ã€‚

### äº’ç›¸è½¬æ¢

#### Base64 -> Blob

å…ˆåˆ©ç”¨ atob å‡½æ•°è¿˜åŸ base64 æ•°æ®åŒºåŸŸçš„å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç„¶åä¾æ¬¡éå†å­—ç¬¦ä¸²ï¼Œåˆ©ç”¨ charCodeAt æå–æ¯ä¸€ä¸ªå­—ç¬¦çš„ Unicode ç å¹¶æ”¾åœ¨ Uint8Array ä¸­ï¼Œæœ€åç›´æ¥ä½¿ç”¨ `new Blob([u8arr])`æ„é€ æ–‡ä»¶å¯¹è±¡ã€‚

```js
function dataUrl2blob(dataUrl) {
  const base64String = /base64,(.*)/.exec(dataUrl)[1];
  const u8arr = new Uint8Array(base64String.length);
  window
    .atob(base64String)
    .split("")
    .forEach((s, index) => {
      u8arr[index] = s.charCodeAt(0);
    });
  return new Blob([u8arr], { type: "image/png" });
}
```

### Blob/File -> Base64

ä½¿ç”¨ FileReader çš„ readAsDataURL æ¥å£

```js
function file2base64(file) {
  return new Promise((resolve) => {
    const fs = new FileReader();
    fs.onload = function () {
      resolve(this.result);
    };
    fs.readAsDataURL(file);
  });
}
```

### Blob -> ArrayBuffer

åˆ©ç”¨ FileReader çš„`readAsArrayBuffer()`è¯»å–ï¼Œåœ¨ onload äº‹ä»¶ä¸­çš„ result å³ä¸ºç»“æœã€‚

### ArrayBuffer -> Blob / File

ç›´æ¥`new Blob([u8arr], { type: 'text/html' })`

> ï¼æ³¨æ„ uint8Array å¤–å±‚çš„æ–¹æ‹¬å·ã€‚

### ArrayBuffer -> å­—ç¬¦ä¸²

å¯ä»¥ä½¿ç”¨ TextDecoder çš„ decode å®ä¾‹æ–¹æ³•æŠŠç±»å‹åŒ–æ•°ç»„è½¬æˆå­—ç¬¦ä¸²ã€‚

### blob -> url

URL.createObjectURL()è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ª DOMStringï¼Œè¡¨ç¤ºæŒ‡å®šçš„ File æˆ– Blob å¯¹è±¡ï¼Œè¿™ä¸ª URL çš„ç”Ÿå‘½å‘¨æœŸå’Œ document ç»‘å®šã€‚

## Reflect

Reflect æ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œå®ƒæä¾›äº†æ‹¦æˆªå’Œæ“ä½œå¯¹è±¡çš„ apiï¼Œç±»ä¼¼äº Mathã€‚

## ES6+å„ç‰ˆæœ¬æ–°ç‰¹æ€§

- ES2016ã€‚Array.prorotype.includes()
- ES2017ã€‚async/awaitã€Object.values()/entries()
- ES2018ã€‚Promise.finally()
- ES2019ã€‚Array.prototype.flat()
- ES2020ã€‚å¯é€‰é“¾æ¥ã€ç©ºå€¼æ“ä½œ??ã€æŒ‰éœ€å¯¼å…¥ã€BigIntã€globalThisã€Promise.allSettled

## Proxy

### handler.has()

é’ˆå¯¹ä»¥ä¸‹æƒ…å†µçš„ä»£ç†æ–¹æ³•ï¼š

- in æŸ¥è¯¢`foo in obj`
- with æŸ¥è¯¢

```js
with (obj) {
  // è¿™é‡Œçš„å–å€¼ä¼šè§¦å‘objçš„handler.has()ä»£ç†
  // true: ä»£è¡¨åœ¨objä¸Šè¿›è¡Œå–å€¼
  // falseï¼š ä»£è¡¨ä¼šå»ä¸Šçº§ä½œç”¨åŸŸå–å€¼
}
```

- Reflect.has()ï¼ˆä¸ in æ“ä½œç¬¦åŠŸèƒ½ä¸€è‡´ï¼‰
